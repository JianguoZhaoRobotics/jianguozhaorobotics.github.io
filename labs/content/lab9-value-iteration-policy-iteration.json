{"version":3,"kind":"Notebook","sha256":"72dddc981bac123e337a6a1a2907e62aeaa0bdd5f561a391dbed4aea7dea5630","slug":"lab9-value-iteration-policy-iteration","location":"/Lab9 - Value Iteration Policy Iteration.ipynb","dependencies":[],"frontmatter":{"title":"Lab9: RL: Value Iteration & Policy Iteration","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Jianguo Zhao","given":"Jianguo","family":"Zhao"},"name":"Jianguo Zhao","affiliations":["Department of Mechanical Engineering, Colorado State University"],"id":"contributors-Users\\jguoz\\OneDrive - Colostate\\Teaching\\MECH 529 Advanced Mechanical Systems\\2025 Fall\\Lab\\All Labs\\myst-generated-uid-0"}],"github":"https://github.com/YOUR_USERNAME/YOUR_REPO","copyright":"2025","affiliations":[{"id":"Department of Mechanical Engineering, Colorado State University","name":"Department of Mechanical Engineering, Colorado State University"}],"exports":[{"format":"ipynb","filename":"Lab9 - Value Iteration Policy Iteration.ipynb","url":"/Lab9 - Value Iterati-63754dd33b6fda46b0405c223cb5c42a.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"id":"b76f4976"},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This lab will guide you through ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jfkzvAJW9X"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Value Iteration","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IjK7iakOi1"}],"key":"CcNqD6Bj8L"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qvzbzmvI0B"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Policy Iteration","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"I5LBBA4N9v"}],"key":"diuwX6o1YO"},{"type":"text","value":" on a small ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eqkYwY6Uau"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Grid World","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"F2zvAkmH8o"}],"key":"xcEHBSWRSv"},{"type":"text","value":". You will learn how to solve Markov Decision Processes (MDPs) using dynamic programming methods. Starting with a custom Grid World environment, you will implement and compare two fundamental RL algorithms: Value Iteration and Policy Iteration. Finally, you will adapt your solution to work with the standard Gymnasium API.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"g05pWAbw68"}],"key":"B8Ek4AZtg7"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"What You Will Learn:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dt5625XAgk"}],"key":"NZzYGM4H56"}],"key":"QDONoUW65S"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Task 1: Grid World Setup","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"UdsgueRzHK"}],"key":"vo8ps2s4Va"}],"key":"JNT9dKvTKA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Define an MDP with states, actions, transition dynamics, rewards, and discount factor.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Bmfi7EoUt8"}],"key":"VPDwVqBbrA"}],"key":"QBSqpMGuUv"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Understand the ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"CzfRAXzJ6O"},{"type":"inlineCode","value":"GridWorld","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VG2DcEFfCD"},{"type":"text","value":" class structure and environment mechanics.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"JV1BZzzE5t"}],"key":"WEwzqXDNlg"}],"key":"gFrtHRjScC"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualize the environment with forbidden cells, goal states, and policies.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"bcFe223u6C"}],"key":"hmbfzNvBOW"}],"key":"JNXw4H6nJX"}],"key":"oN2VZvm14I"}],"key":"a8ivuoDvCU"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Task 2: Value Iteration","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"gwFRb07aw2"}],"key":"ktjtpW7j8R"}],"key":"cU1waR5BoC"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Implement the Value Iteration algorithm using the Bellman optimality equation.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fZMEYAQLHy"}],"key":"TbRxc1j9D3"}],"key":"EeZAwHXzAd"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Perform synchronous updates to compute optimal state values and policy.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"rrcXfHZTmC"}],"key":"HwB5gPl8ew"}],"key":"TJfSAiN5fG"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Understand convergence criteria and interpret the resulting value function and policy.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"yA94rOFb9M"}],"key":"Uac6e7NX0c"}],"key":"x4WiOvhks4"}],"key":"MvVk2HVpot"}],"key":"DQDPvkCn5G"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Task 3: Policy Iteration","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"wXmXYTyShj"}],"key":"hRanhawfOo"}],"key":"hbfaWpHNCM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Implement Policy Evaluation to compute the value function for a given policy.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"KeqbRu8vC6"}],"key":"FOlm6ipXhe"}],"key":"RuJBSid2ko"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Implement Policy Improvement to update the policy greedily.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"DOf1izGYFy"}],"key":"wi2mC2ej5W"}],"key":"O13nm3YaFO"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Compare Policy Iteration with Value Iteration in terms of iterations and computational cost.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ICgWBvaSks"}],"key":"b5aUQzqVPP"}],"key":"Sxa4X4XP0h"}],"key":"D19U5bFLRl"}],"key":"kXAVa7Hmaj"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"strong","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Task 4: Using Gymnasium","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"rSnajzGfVH"}],"key":"AIBl8Hr7UX"}],"key":"INIkNkEUKj"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Rewrite the Grid World environment following the Gymnasium API (","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"MTNSfxLQqK"},{"type":"inlineCode","value":"reset()","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"m60axHTck9"},{"type":"text","value":", ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"P4aI3Zt8zb"},{"type":"inlineCode","value":"step()","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"GoGI4SlW3p"},{"type":"text","value":", ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"hulyU6Xoo9"},{"type":"inlineCode","value":"render()","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"OtzRnt4QAk"},{"type":"text","value":").","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"Q5r11fVMsE"}],"key":"teNvDv9KGJ"}],"key":"x6qIVOFcwE"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Understand action spaces (","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"RnY8z8ivAD"},{"type":"inlineCode","value":"Discrete","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"U6vHuz2Fef"},{"type":"text","value":") and observation spaces (","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"B1Qcyakk1j"},{"type":"inlineCode","value":"MultiDiscrete","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"AHgPyscqsl"},{"type":"text","value":").","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"sM5uZtUqRd"}],"key":"BA1Jlsga7u"}],"key":"e3h8y5RAS9"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Implement Value Iteration for the Gymnasium-based environment and verify compatibility with standard RL frameworks.","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"ioLfRlNIVQ"}],"key":"QtJyR3jHzP"}],"key":"WhZLd5w6ui"}],"key":"vPxiR1PIiu"}],"key":"g2gsqfWotD"}],"key":"Y3xXdcnJNP"}],"identifier":"b76f4976","label":"b76f4976","html_id":"b76f4976","key":"RImHmoVo8Y"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":17,"status":"ok","timestamp":1763751899144,"user":{"displayName":"Jianguo Zhao","userId":"09996222056778326224"},"user_tz":420},"id":"8615ba9f","outputId":"f5ec0db7-5a6a-4696-8988-8795cb19fdab"},"children":[{"type":"code","lang":"python","executable":true,"value":"\n# Minimal prerequisites\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# Matplotlib: one chart per cell; no specific styles or colors set per instructions.\nprint(\"NumPy:\", np.__version__)\nprint(\"Matplotlib:\", plt.matplotlib.__version__)","identifier":"8615ba9f-code","enumerator":"1","html_id":"id-8615ba9f-code","key":"KawfZH6yMK"},{"type":"outputs","id":"wVfM0FzyqFVHyBR39LHvl","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"NumPy: 2.0.2\nMatplotlib: 3.10.0\n"},"children":[],"identifier":"8615ba9f-outputs-0","html_id":"id-8615ba9f-outputs-0","key":"QKiZEeyvHv"}],"identifier":"8615ba9f-outputs","html_id":"id-8615ba9f-outputs","key":"deVGGipLrz"}],"identifier":"8615ba9f","label":"8615ba9f","html_id":"id-8615ba9f","key":"eKLAnaEXGr"},{"type":"block","kind":"notebook-content","data":{"id":"978a7fb3"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Task 1. Grid World Setup","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d1o3WEgKTW"}],"identifier":"task-1-grid-world-setup","label":"Task 1. Grid World Setup","html_id":"task-1-grid-world-setup","implicit":true,"key":"xokogNGmKC"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We use a small rectangular grid to represent the environment. Each cell in the grid corresponds to a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"c5OGODseWg"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"state","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MGjQM0gps4"}],"key":"cYKgAv2GbZ"},{"type":"text","value":" that the agent can occupy. At each state, the agent can attempt one of five possible ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Bms7PgqlCz"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"actions","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kZpfuxbuzN"}],"key":"J2G9Ld9UVI"},{"type":"text","value":": up, right, down, left, or stay.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Esr1VLGK5M"}],"key":"PZIVEGh9fH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"States","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QwzqIFN2g1"}],"key":"fuFRTMsiWH"},{"type":"text","value":": A state is represented by a tuple ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jE2gkLWICQ"},{"type":"inlineCode","value":"(row, column)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"N8vtcZ5wSK"},{"type":"text","value":", indicating the agent’s position. The grid is zero-indexed, so the top-left corner is ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NjozQ80dZM"},{"type":"inlineCode","value":"(0, 0)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ib6dFBfeOa"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Q7YD9yhc3p"}],"key":"Q6wGoc4LyY"}],"key":"nQnXeTIswF"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Actions","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"edP95CszUV"}],"key":"qWltMpkrd6"},{"type":"text","value":": Actions are represented by integers from 0 to 4: ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"EZAT0a4zwu"},{"type":"inlineCode","value":"0","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tcH1ouPUTb"},{"type":"text","value":" (up), ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"QiCD9UtBL9"},{"type":"inlineCode","value":"1","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Kg33deX8EF"},{"type":"text","value":" (right), ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xn2FzeJNtP"},{"type":"inlineCode","value":"2","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"s39x45mUSO"},{"type":"text","value":" (down), ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"fey0NlLIzE"},{"type":"inlineCode","value":"3","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"I9TQtkLGwY"},{"type":"text","value":" (left), and ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"NPOgtMf5v9"},{"type":"inlineCode","value":"4","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"nBvn8zLIXc"},{"type":"text","value":" (stay).","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"BqBaSyH5WL"}],"key":"NMYhgzLkPG"}],"key":"sYVvM42KbD"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Transitions","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"cvE7OhRFcM"}],"key":"NcNYINmQ6G"},{"type":"text","value":": If an action moves the agent off the grid, the agent remains in its current state and receives a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SMiwSUIaaD"},{"type":"inlineCode","value":"boundary_reward","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"cCk4FhwaS2"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Vl7bLck2AG"}],"key":"qgk2cIXtij"}],"key":"Oc6s2oTEbC"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Rewards","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"dcIKNMzXQN"}],"key":"gxDTKDb6NU"},{"type":"text","value":": The environment provides different rewards based on the outcome of an action:","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"hQ6QvZ1n7c"}],"key":"pXI5hGKh2J"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"goal_reward","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lnS9FQezqI"},{"type":"text","value":": For reaching the goal state.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GCisID42yZ"}],"key":"XPynw1U4sx"}],"key":"lLSWdjJo1h"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"forbidden_reward","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lbOsf3z42c"},{"type":"text","value":": For entering a forbidden cell.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ntQszQSu9H"}],"key":"J1rIOJZCyz"}],"key":"giXT8kXJXq"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"boundary_reward","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"vz1MIRWtri"},{"type":"text","value":": For hitting a wall or boundary.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"yMO7pyUasB"}],"key":"Slg3NApFug"}],"key":"r2rDnMaAgP"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"step_reward","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"J3PqioYKNl"},{"type":"text","value":": For any other valid move.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"t5Jxzu0I5E"}],"key":"NTEMgJSRGt"}],"key":"ZQYkzv8Jws"}],"key":"kcJKktfxym"}],"key":"D3uNo9LimJ"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Discount Factor (","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"jymt38ugU5"},{"type":"inlineCode","value":"gamma","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"QlV7StYL2h"},{"type":"text","value":")","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"yPLFnlKtjY"}],"key":"VO9zPxTjwK"},{"type":"text","value":": A value between 0 and 1 that balances the importance of immediate rewards versus future rewards.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"bzMkl4yQNw"}],"key":"VsXXaAtR5R"}],"key":"MA7AQ7PAo7"}],"key":"Hv1F9f2eo8"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"v209B8xy0g"},{"type":"inlineCode","value":"GridWorld","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"S9HiG0Oo6d"},{"type":"text","value":" class encapsulates this entire setup, managing the grid, states, actions, transitions, and rewards. A ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"R7yHtB5aYL"},{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"class","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"psYbH88a4p"}],"key":"zJoIrkudpo"},{"type":"text","value":" in Python is a blueprint for creating objects. It bundles data (attributes) and functions that operate on that data (methods) into a single, organized unit. An object created from a class is called an instance.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"NB01ZfHABM"}],"key":"BXdqmVhLO5"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"In contrast, a ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"OyQlUGqx1C"},{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"function","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"xyeKXgMuYi"}],"key":"Ny4B9KlOGi"},{"type":"text","value":" is a standalone block of code that performs a specific task. While functions can take inputs and produce outputs, they don’t inherently store data or maintain a state between calls. A class, through its instances, can maintain its state (the values of its attributes) over time, making it ideal for representing complex entities like our ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"HW3fQIi50N"},{"type":"inlineCode","value":"GridWorld","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"QczldTsxSX"},{"type":"text","value":" environment, which needs to keep track of its configuration (grid size, rewards, etc.) across multiple interactions.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"pwogr5U3tI"}],"key":"a3D4uaQeWf"}],"identifier":"978a7fb3","label":"978a7fb3","html_id":"id-978a7fb3","key":"rZuwbOwTbf"},{"type":"block","kind":"notebook-code","data":{"id":"f8219f5b"},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define actions and their visual representations\nACTIONS = [0, 1, 2, 3, 4]  # up, right, down, left, stay\nACTION_ARROWS = {0:\"↑\", 1:\"→\", 2:\"↓\", 3:\"←\", 4:\"*\"} # For rendering the policy\n\nclass GridWorld:\n    \"\"\"\n    A class to represent the Grid World environment.\n    Manages the grid, states, actions, transitions, and rewards.\n    \"\"\"\n    def __init__(self,\n                 grid_shape=(5, 5),  # number of rows and columns\n                 forbidden=None,\n                 goal=None,\n                 goal_reward=10.0,\n                 step_reward=0.0,\n                 forbidden_reward=-1.0,\n                 boundary_reward=-1.0,\n                 gamma=0.9):\n        \"\"\"\n        Initializes the GridWorld environment.\n\n        Args:\n            grid_shape (tuple): The (rows, columns) of the grid.\n            forbidden (list): A list of (row, col) tuples for forbidden states.\n            goal (tuple): The (row, col) of the goal state.\n            goal_reward (float): Reward for reaching the goal.\n            step_reward (float): Reward for a standard step.\n            forbidden_reward (float): Penalty for entering a forbidden state.\n            boundary_reward (float): Penalty for hitting a wall or boundary.\n            gamma (float): The discount factor for future rewards.\n        \"\"\"\n        self.grid_shape = grid_shape\n        # Default locations for forbidden cells and the goal if not provided\n        self.forbidden = forbidden if forbidden is not None else [(1,1), (1,2),(2,2), (3,1), (3,3) ,(4,1)] # Example forbidden positions\n        self.goal = goal if goal is not None else (3,2) # Example goal position\n\n        # Reward structure\n        self.goal_reward = goal_reward\n        self.step_reward = step_reward\n        self.forbidden_reward = forbidden_reward\n        self.boundary_reward = boundary_reward\n\n        # Discount factor\n        self.gamma = gamma\n\n    def in_bounds(self, s):\n        \"\"\"Check if a state 's' is within the grid boundaries.\"\"\"\n        r, c = s # r is the row, c is the column\n        R, C = self.grid_shape # Total rows and columns\n        return 0 <= r < R and 0 <= c < C # if within bounds then return True\n\n    def is_forbidden(self, s):\n        \"\"\"Check if a state 's' is a forbidden cell.\"\"\"\n        return s in self.forbidden # if s is in forbidden list then return True\n\n    def states(self):\n        \"\"\"Returns a list of all states in the grid.\"\"\"\n        R, C = self.grid_shape\n        return [(r, c) for r in range(R) for c in range(C)]\n\n    def step(self, s, a):\n        \"\"\"\n        Performs a state transition based on the current state and action.\n        This function defines the environment's dynamics.\n\n        Args:\n            s (tuple): The current state (row, col).\n            a (int): The action to take.\n\n        Returns:\n            tuple: A tuple containing the next state (next_s) and the reward.\n        \"\"\"\n        assert a in ACTIONS, f\"Invalid action: {a}. Valid actions are: {ACTIONS}\"\n\n        r, c = s\n        # Determine the next potential position based on the action\n        if a == 0:    nr, nc = r-1, c    # up\n        elif a == 1:  nr, nc = r, c+1    # right\n        elif a == 2:  nr, nc = r+1, c    # down\n        elif a == 3:  nr, nc = r, c-1    # left\n        else:         nr, nc = r, c      # stay\n\n        # Check for boundary collisions or walls\n        if (not self.in_bounds((nr, nc))):\n            next_s = s  # Agent stays in the same state\n            reward = self.boundary_reward\n        else:\n            # The move is valid, so the agent moves to the new position\n            next_s = (nr, nc)\n            # Determine the reward based on the new state\n            if next_s == self.goal:\n                reward = self.goal_reward\n            elif self.is_forbidden(next_s):\n                reward = self.forbidden_reward\n            else:\n                reward = self.step_reward\n\n        return next_s, reward","identifier":"f8219f5b-code","enumerator":"2","html_id":"f8219f5b-code","key":"z38DBS4eRl"},{"type":"outputs","id":"fR0l8yDFZ8pbSgQRCD0Jn","children":[],"identifier":"f8219f5b-outputs","html_id":"f8219f5b-outputs","key":"EjuFYQO1qf"}],"identifier":"f8219f5b","label":"f8219f5b","html_id":"f8219f5b","key":"WHdubEesjt"},{"type":"block","kind":"notebook-content","data":{"id":"c6e5ddec"},"children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Visualization helpers","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Nzwv2ijWEm"}],"identifier":"visualization-helpers","label":"Visualization helpers","html_id":"visualization-helpers","implicit":true,"key":"lfateBSyup"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"plot_values(V)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ywpr0KImCQ"},{"type":"text","value":": Creates a heatmap to visualize the value of each state. Higher values are typically shown in brighter colors, providing an intuitive overview of which states are more desirable for the agent.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"nfDZdeIDcS"}],"key":"MYXV5nucTl"}],"key":"gVpXSGgOXy"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"render_policy(P)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nQbrjtfhVH"},{"type":"text","value":": table of arrows showing the greedy action per state.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"i8GUGsNMBz"}],"key":"BgubvmG0do"}],"key":"Peda1mPlKR"}],"key":"vMtFGqDIQG"}],"identifier":"c6e5ddec","label":"c6e5ddec","html_id":"c6e5ddec","key":"jFn3jeLFYl"},{"type":"block","kind":"notebook-code","data":{"id":"a12ca038"},"children":[{"type":"code","lang":"python","executable":true,"value":"ACTION_ARROWS = {\n    0: \"↑\",   # down\n    1: \"→\",   # right\n    2: \"↓\",   # up\n    3: \"←\",   # left\n    4: \"•\",   # stay\n}\n\ndef render_policy_with_values(env, P, V=None, title=\"Policy and Values\", ax=None, show=True):\n    \"\"\"\n    Renders the greedy policy as arrows and overlays the value for each state in a matplotlib plot.\n\n    Args:\n        env: GridWorld environment object. Should provide .grid_shape and .is_forbidden().\n        P (dict): The policy mapping states (r, c) to actions (int).\n        V (dict): Optional. A dictionary mapping states to their values.\n        title (str): Title of the plot.\n        ax: Optional matplotlib axes object. If provided, plots on this axes instead of creating a new figure.\n        show (bool): Whether to call plt.show() at the end. Default True. Set False when creating subplots.\n\n    Returns:\n        tuple: (fig, ax) - The figure and axes objects.\n    \"\"\"\n    import matplotlib.pyplot as plt\n    import numpy as np\n\n    R, C = env.grid_shape\n    if ax is None:\n        fig, ax = plt.subplots(figsize=(7, 6))\n    else:\n        fig = ax.figure\n    ax.set_xlim(-0.5, C - 0.5)\n    ax.set_ylim(-0.5, R - 0.5)\n    ax.set_xticks(np.arange(-0.5, C, 1))\n    ax.set_yticks(np.arange(-0.5, R, 1))\n    ax.grid(True, color='gray', linewidth=1, linestyle='-')\n    ax.set_aspect('equal')\n    ax.invert_yaxis()  # Match array indexing\n\n    # Draw cell highlights for forbidden/goal/start\n    for r in range(R):\n        for c in range(C):\n            s = (r, c)\n            if env.is_forbidden(s):\n                rect = plt.Rectangle((c-0.5, r-0.5), 1, 1, color='gray', alpha=0.5)\n                ax.add_patch(rect)\n                ax.text(c, r, \"X\", ha='center', va='center', color='black', fontsize=14)\n            elif s == env.goal:\n                rect = plt.Rectangle((c-0.5, r-0.5), 1, 1, color='yellow', alpha=0.45)\n                ax.add_patch(rect)\n                ax.text(c, r, \"G\", ha='center', va='center', color='black', fontsize=14)\n            elif s == getattr(env, \"start_state\", None):\n                rect = plt.Rectangle((c-0.5, r-0.5), 1, 1, color='deepskyblue', alpha=0.35)\n                ax.add_patch(rect)\n                ax.text(c, r, \"S\", ha='center', va='center', color='black', fontsize=14)\n\n    # Print arrows and values in every cell (except forbidden)\n    for r in range(R):\n        for c in range(C):\n            s = (r, c)\n            # Print policy arrow\n            if (r, c) in P:\n                arrow = ACTION_ARROWS[P[(r, c)]]\n            else:\n                arrow = \"\"\n            if (V is not None) and ((r, c) in V):\n                valstr = f\"{V[(r, c)]:.2f}\"\n            else:\n                valstr = \"\"\n            # Place arrow in cell\n            ax.text(\n                c, r-0.18, arrow,\n                ha='center', va='center', color='darkblue', fontsize=22, fontweight='bold', zorder=10\n            )\n            # Always show value in each cell (if provided), not just if valstr != \"\"\n            ax.text(\n                c, r+0.27, valstr if valstr != \"\" else \"\",\n                ha='center', va='center', color='crimson', fontsize=11, alpha=0.99,\n                bbox=dict(facecolor=\"white\", alpha=0.63, edgecolor='none', boxstyle='round,pad=0.16'),\n                zorder=10\n            )\n\n    # Label grid\n    for x in range(C):\n        ax.text(x, -0.75, str(x+1), ha='center', va='center', color='black')\n    for y in range(R):\n        ax.text(-0.75, y, str(y+1), ha='center', va='center', color='black')\n\n    ax.set_title(title)\n    ax.tick_params(bottom=False, left=False, right=False, top=False,\n                   labelbottom=False, labelleft=False, labeltop=False, labelright=False)\n    if show:\n        plt.tight_layout()\n        plt.show()\n\n    return fig, ax","identifier":"a12ca038-code","enumerator":"3","html_id":"a12ca038-code","key":"mqIErGvTY8"},{"type":"outputs","id":"27J4Di_cXAJjnc7nO1ArF","children":[],"identifier":"a12ca038-outputs","html_id":"a12ca038-outputs","key":"JOmPmDOyLS"}],"identifier":"a12ca038","label":"a12ca038","html_id":"a12ca038","key":"y8p8t6u6Q6"},{"type":"block","kind":"notebook-content","data":{"id":"bfa335ec"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Task 2. Value Iteration","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mE0vUiFwSn"}],"identifier":"task-2-value-iteration","label":"Task 2. Value Iteration","html_id":"task-2-value-iteration","implicit":true,"key":"jwHBR5SU4Q"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We first implement value iteration to find the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pfqlknmYM9"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"optimal value function","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KDdkanzx9e"}],"key":"IEM6gdf4tf"},{"type":"text","value":" (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vyGgW8owEa"},{"type":"inlineMath","value":"v^*","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>v</mi><mo>∗</mo></msup></mrow><annotation encoding=\"application/x-tex\">v^*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6887em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span></span></span></span>","key":"oNtOzgb9zj"},{"type":"text","value":") and the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dy4J9xJwMa"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"optimal policy","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dtoJc0ZqAA"}],"key":"LZHVc2S4VH"},{"type":"text","value":" (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cbo3lrMOg7"},{"type":"inlineMath","value":"\\pi^*","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>π</mi><mo>∗</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\pi^*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6887em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span></span></span></span>","key":"xWZVeFhKUj"},{"type":"text","value":"). The value function ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VXxiEK23Ay"},{"type":"inlineMath","value":"v^*(s)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>v</mi><mo>∗</mo></msup><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v^*(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"NzUNRuayZz"},{"type":"text","value":" tells us the maximum expected future return an agent can get starting from state ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oCGIn2Rsdq"},{"type":"inlineMath","value":"s","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"V4rIt1Kazf"},{"type":"text","value":". The policy ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"n4gIW4JQiE"},{"type":"inlineMath","value":"\\pi^*(s)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>π</mi><mo>∗</mo></msup><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\pi^*(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"gZxW4Kazf4"},{"type":"text","value":" tells us the best action to take in state ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"f0CAImLgSx"},{"type":"inlineMath","value":"s","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"xEaeZPAWbR"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"m0zSInVdGN"}],"key":"Qf0UE2M0X6"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"These are found by solving the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uJTvvnUaRs"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Bellman Optimality Equation","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wnNAexVvf4"}],"key":"sZqFbEqvQ6"},{"type":"text","value":". For our deterministic Grid World, this equation simplifies to:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zPPiavB4I8"}],"key":"BdTc4Vm1A4"},{"type":"math","value":"v^*(s) = \\max_{a \\in A} \\Big[ r(s,a) + \\gamma v^*(s') \\Big]","position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>v</mi><mo>∗</mo></msup><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>=</mo><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mi>a</mi><mo>∈</mo><mi>A</mi></mrow></munder><mo fence=\"false\" stretchy=\"true\" minsize=\"1.8em\" maxsize=\"1.8em\">[</mo><mi>r</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>γ</mi><msup><mi>v</mi><mo>∗</mo></msup><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"1.8em\" maxsize=\"1.8em\">]</mo></mrow><annotation encoding=\"application/x-tex\">v^*(s) = \\max_{a \\in A} \\Big[ r(s,a) + \\gamma v^*(s&#x27;) \\Big]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7387em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.9217em;vertical-align:-0.7717em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4306em;\"><span style=\"top:-2.3557em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mrel mtight\">∈</span><span class=\"mord mathnormal mtight\">A</span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">max</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7717em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"delimsizing size2\">[</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.8em;vertical-align:-0.65em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7387em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"delimsizing size2\">]</span></span></span></span></span></span>","enumerator":"1","key":"oNk4bxdMUT"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"where:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"DIuVCH9ZHr"}],"key":"AjYiIpqhTS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineMath","value":"s","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"CDunlfQYRs"},{"type":"text","value":" is the current state.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ROU8lnAFVF"}],"key":"bknwfuYO0x"}],"key":"tFNiZJFaS2"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineMath","value":"a","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"HpkXzoTLae"},{"type":"text","value":" is a possible action.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"D3eWnD1Lv7"}],"key":"pDkzpvyTJD"}],"key":"iKAsuG4Xsl"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineMath","value":"s'","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">s&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span>","key":"l8Kcw4HdXi"},{"type":"text","value":" is the state you land in after taking action ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Uastq5tG6O"},{"type":"inlineMath","value":"a","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"IpYQXGZvEj"},{"type":"text","value":" from state ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"sXxk6p9INX"},{"type":"inlineMath","value":"s","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"rpaWhRZdk3"},{"type":"text","value":".","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"oPMzYdrGGH"}],"key":"svmnrVd7sq"}],"key":"phkb2Ezttw"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineMath","value":"r(s,a)","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">r(s,a)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span></span></span></span>","key":"c7pA1SasWY"},{"type":"text","value":" is the immediate reward.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"aToZ40fvnw"}],"key":"vU3t2r75e1"}],"key":"UVKdaImurc"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineMath","value":"\\gamma","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>","key":"cy3zbMeDI7"},{"type":"text","value":" (gamma) is the discount factor, which balances immediate vs. future rewards.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"YxnpDmkKCF"}],"key":"s1EvoYvEdZ"}],"key":"Ud7RBASfVJ"}],"key":"cLMC0n27qi"},{"type":"heading","depth":3,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Algorithm","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Vo4giGAd57"}],"identifier":"algorithm","label":"Algorithm","html_id":"algorithm","implicit":true,"key":"b9BCB2f6pw"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Value Iteration finds the optimal value function and policy by repeatedly applying the Bellman optimality equation. The algorithm iterates, updating both the value estimates and the policy at each step until convergence.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"O6H0z56IDC"}],"key":"QFZ8HWQmhR"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"1. Initialization","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"bQyEPu7EPg"}],"key":"g1jA8WJt4T"}],"key":"kA5YhlJ2ZZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Initialize an arbitrary value function ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"KHGz45irKH"},{"type":"inlineMath","value":"v_0(s)","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v_0(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"epHgizTYfR"},{"type":"text","value":" for all states ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"ExaapXIGVU"},{"type":"inlineMath","value":"s","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"dAreedl3OJ"},{"type":"text","value":" (e.g., all zeros).","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"D685qVhtmR"}],"key":"poE3eJYyqn"}],"key":"X9D2cjFJ3h"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Choose a small positive number ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"UYWXWafWS8"},{"type":"inlineCode","value":"theta","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"RVA69u1ZTH"},{"type":"text","value":" (","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"dkgv5sbQwH"},{"type":"inlineMath","value":"\\theta","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span>","key":"x0jJaS6Sbx"},{"type":"text","value":") to check for convergence.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"Zi7PyQJ0TY"}],"key":"X6jWneA2PB"}],"key":"QB1HbZ2B3K"}],"key":"vzB35gG0JI"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"strong","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"2. Iteration and Synchronous Updates","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"Cdb5t7vwab"}],"key":"D5CiOte8gi"}],"key":"QiVit10AHN"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Repeat for each iteration ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"EfyIxuEIYF"},{"type":"inlineMath","value":"k=0, 1, 2, \\dots","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mo>…</mo></mrow><annotation encoding=\"application/x-tex\">k=0, 1, 2, \\dots</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span></span></span></span>","key":"hdXi0bo7xh"},{"type":"text","value":" until convergence:","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"eX0VncF2kS"}],"key":"ucRLCWhBmI"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":31,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"For every state ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"owoTb0SfZQ"},{"type":"inlineMath","value":"s \\in S","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>∈</mo><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">s \\in S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>","key":"yUxgCNT0lO"},{"type":"text","value":":","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"qu4E5fIycQ"}],"key":"ETPtfQvsWu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":32,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":32,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"a. Compute Action-Values (q-values)","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"F1D0YU8KfF"}],"key":"Z7dnJ6n88r"},{"type":"text","value":": For each possible action ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"AyFYN1KaKb"},{"type":"inlineMath","value":"a","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"FaLnGiKQio"},{"type":"text","value":", calculate its value using the value function from the ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"iUeWNJ39RE"},{"type":"emphasis","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"previous","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"R3igxvuG1s"}],"key":"sDSa7pX1sD"},{"type":"text","value":" iteration, ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"id0WpYzYpS"},{"type":"inlineMath","value":"v_k","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">v_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"YkD8SYrk4h"},{"type":"text","value":":\n","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"ZQweqFdIKn"}],"key":"lMSGveITY3"},{"type":"math","value":"q_k(s,a) = r(s,a) + \\gamma v_k(s')","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>q</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>r</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>γ</mi><msub><mi>v</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">q_k(s,a) = r(s,a) + \\gamma v_k(s&#x27;)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0519em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"2","key":"nkkL9BgZG7"}],"key":"CjBxRDKW30"},{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"b. Find Best Action","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"aiDIymOIfO"}],"key":"YoLswnOxYl"},{"type":"text","value":": Identify the best action ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"YGFjXsVipR"},{"type":"inlineMath","value":"a_k^{*}(s)","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>a</mi><mi>k</mi><mo lspace=\"0em\" rspace=\"0em\">∗</mo></msubsup><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a_k^{*}(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0331em;vertical-align:-0.2831em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-2.4169em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∗</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2831em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"M2FQ3ZQ95d"},{"type":"text","value":" that maximizes the q-value:\n","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"FTZkLYLTKq"}],"key":"XqMIpHMhDI"},{"type":"math","value":"a_k^{*}(s) = \\arg\\max_{a} q_k(s,a)","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msubsup><mi>a</mi><mi>k</mi><mo lspace=\"0em\" rspace=\"0em\">∗</mo></msubsup><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>arg</mi><mo>⁡</mo><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mi>a</mi></munder><msub><mi>q</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a_k^{*}(s) = \\arg\\max_{a} q_k(s,a)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7387em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∗</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.45em;vertical-align:-0.7em;\"></span><span class=\"mop\">ar<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4306em;\"><span style=\"top:-2.4em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">max</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"3","key":"PVJ5cY81XZ"}],"key":"uGFptsB2go"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"c. Update Policy","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"xaqprra1rF"}],"key":"eVqUZ1x8RR"},{"type":"text","value":": Update the policy for the next iteration, ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"ryNVZg8A2l"},{"type":"inlineMath","value":"\\pi_{k+1}","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>π</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\pi_{k+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span>","key":"qVpoSvZMWI"},{"type":"text","value":", to be greedy with respect to the q-values:\n","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"YMiPc3mXfD"}],"key":"pqmp30t0W7"},{"type":"math","value":"\\pi_{k+1}(s) = a_k^*(s)","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>π</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msubsup><mi>a</mi><mi>k</mi><mo>∗</mo></msubsup><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\pi_{k+1}(s) = a_k^*(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7387em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"4","key":"x8QWrdXHu2"}],"key":"rMJseIprAL"},{"type":"listItem","spread":true,"position":{"start":{"line":44,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"d. Update State-Value","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"UzNdN5VXrU"}],"key":"uVIFNGmQZn"},{"type":"text","value":": Update the state-value for the next iteration, ","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"aArnZhyvUh"},{"type":"inlineMath","value":"v_{k+1}","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">v_{k+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span>","key":"mgtxPIURPS"},{"type":"text","value":", with the value of the best action:\n","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"HsU252wD6o"}],"key":"pU64pwDgb2"},{"type":"math","value":"v_{k+1}(s) = \\max_{a} q_k(s,a)","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>v</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>=</mo><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mi>a</mi></munder><msub><mi>q</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v_{k+1}(s) = \\max_{a} q_k(s,a)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.45em;vertical-align:-0.7em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4306em;\"><span style=\"top:-2.4em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">max</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"5","key":"LsPfLmknPj"}],"key":"Vn6B3OIVxB"}],"key":"oWAuqoFfnK"}],"key":"vyZLARF2ZB"}],"key":"EE5LbtKbVi"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"strong","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"3. Convergence Check","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"Hzt3voknfm"}],"key":"FYPyYF8hDn"}],"key":"dJtabwD1AJ"},{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"The algorithm has converged when the largest change in any state’s value is less than ","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"JQ6H5bMSzq"},{"type":"inlineCode","value":"theta","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"a5pu6k5F4z"},{"type":"text","value":":","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"SaRyScMjcc"}],"key":"JZGfiSSN8J"},{"type":"math","value":"\\max_{s \\in S} |v_{k+1}(s) - v_k(s)| < \\theta","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"tight":true,"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mi>s</mi><mo>∈</mo><mi>S</mi></mrow></munder><mi mathvariant=\"normal\">∣</mi><msub><mi>v</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>v</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">∣</mi><mo>&lt;</mo><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\max_{s \\in S} |v_{k+1}(s) - v_k(s)| &lt; \\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.5217em;vertical-align:-0.7717em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4306em;\"><span style=\"top:-2.3557em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mrel mtight\">∈</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">max</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7717em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span></span>","enumerator":"6","key":"ym6Q0oiCjw"},{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"Once converged, ","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"XyUzde2pfM"},{"type":"inlineMath","value":"v_{k+1}","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">v_{k+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span>","key":"PA1pOVWqSJ"},{"type":"text","value":" and ","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"rTy8dvHlwV"},{"type":"inlineMath","value":"\\pi_{k+1}","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>π</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\pi_{k+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span>","key":"XSNUp6ZW9f"},{"type":"text","value":" are the optimal value function ","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"vk7eAYLweU"},{"type":"inlineMath","value":"v^*","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>v</mi><mo>∗</mo></msup></mrow><annotation encoding=\"application/x-tex\">v^*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6887em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span></span></span></span>","key":"pTfn8jYM3K"},{"type":"text","value":" and optimal policy ","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"O6AFfRx4i6"},{"type":"inlineMath","value":"\\pi^*","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>π</mi><mo>∗</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\pi^*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6887em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span></span></span></span>","key":"iBs2uxfeiK"},{"type":"text","value":".","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"RSP9AdI3Lh"}],"key":"zkj62j6zwj"}],"identifier":"bfa335ec","label":"bfa335ec","html_id":"bfa335ec","key":"OwlqY7KZN1"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/","height":662},"executionInfo":{"elapsed":159,"status":"ok","timestamp":1763753993977,"user":{"displayName":"Jianguo Zhao","userId":"09996222056778326224"},"user_tz":420},"id":"daacefa2","outputId":"8f57a218-3113-4622-ab6b-df6fe110277e"},"children":[{"type":"code","lang":"python","executable":true,"value":"def value_iteration(env, theta, max_iters):\n    \"\"\"\n    Performs Value Iteration to find the optimal value function and policy,\n    following the structure of the provided pseudocode.\n\n    Args:\n        env: The GridWorld environment.\n        theta (float): A small threshold for determining convergence.\n        max_iters (int): The maximum number of iterations to prevent infinite loops.\n\n    Returns:\n        tuple: A tuple containing:\n            - V (dict): The optimal value function, mapping states to values.\n            - Pi (dict): The optimal policy, mapping states to actions.\n            - iters (int): The number of iterations until convergence.\n    \"\"\"\n    # Initialization: Initial guess v0\n    V = {s: 0.0 for s in env.states()}\n    Pi = {s: 0 for s in env.states()} # Policy can be initialized arbitrarily\n    iters = 0\n\n    while True:\n        delta = 0.0\n        V_old = V.copy() # Store vk to calculate delta = ||vk - vk-1||\n\n        # For every state s ∈ S, do\n        for s in env.states():\n            # For every action a ∈ A(s), do\n            # q-value: qk(s, a) = r(s,a) + γ * V(s')\n            q_values = {}\n            for a in ACTIONS:\n                s_next, r = env.step(s, a) # Get next state and reward\n                q_values[a] = r + env.gamma * V_old[s_next] # get the action value\n\n            # Maximum action value: a*k(s) = arg maxa qk(a, s)\n            best_action = max(q_values, key=q_values.get)\n\n            # Value update: vk+1(s) = maxa qk(a, s)\n            best_value = q_values[best_action]\n            V[s] = best_value\n\n            # Policy update: πk+1(s) = a*k(s)\n            Pi[s] = best_action\n\n            # Check for convergence\n            delta = max(delta, abs(V[s] - V_old[s]))\n\n        iters += 1\n        if delta < theta or iters >= max_iters:\n            break\n\n        # Show intermediate policy and values during value iteration\n        # if iters % 20 == 0 or delta < theta:  # Visualize every 10 steps and at convergence\n        #     render_policy_with_values(env, Pi, V, title=f\"Value Iteration Step {iters}\")\n        #     import time\n        #     time.sleep(1)\n        #     plt.close('all')  # Close all existing figures before drawing a new one\n    return V, Pi, iters\n\n# Demo run\nenv = GridWorld()\nV_vi, Pi_vi, n_vi = value_iteration(env, 1e-3, 1000)\nprint(f\"Value Iteration converged in {n_vi} iterations.\")\nrender_policy_with_values(env, Pi_vi, V_vi, title=\"Policy and Values\")","identifier":"daacefa2-code","enumerator":"4","html_id":"daacefa2-code","key":"Jo6NglIzYu"},{"type":"outputs","id":"82n3cfjDFE4f17wq-cjv2","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Value Iteration converged in 89 iterations.\n"},"children":[],"identifier":"daacefa2-outputs-0","html_id":"daacefa2-outputs-0","key":"nOdfBaHmJA"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7a561131f172ebe59a1af0370cfd7eee","path":"/7a561131f172ebe59a1af0370cfd7eee.png"},"text/plain":{"content":"<Figure size 700x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"daacefa2-outputs-1","html_id":"daacefa2-outputs-1","key":"Gt4gaRWnwR"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/plain":{"content":"(<Figure size 700x600 with 1 Axes>,\n <Axes: title={'center': 'Policy and Values'}>)","content_type":"text/plain"}}},"children":[],"identifier":"daacefa2-outputs-2","html_id":"daacefa2-outputs-2","key":"Gndt85u298"}],"identifier":"daacefa2-outputs","html_id":"daacefa2-outputs","key":"dOK2tFSCla"}],"identifier":"daacefa2","label":"daacefa2","html_id":"daacefa2","key":"ZPWbbtvp8X"},{"type":"block","kind":"notebook-content","data":{"id":"7dad3ad6"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Task 3. Policy Iteration","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TgMggrK2Uq"}],"identifier":"task-3-policy-iteration","label":"Task 3. Policy Iteration","html_id":"task-3-policy-iteration","implicit":true,"key":"RbQNxDUQ67"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We then implement policy interation to find the optimal policy ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"jlobuTkfnh"},{"type":"inlineMath","value":"\\pi^*","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>π</mi><mo>∗</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\pi^*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6887em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span></span></span></span>","key":"oDWH4na8yg"},{"type":"text","value":" and its corresponding value function ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"bXkUbzgsIT"},{"type":"inlineMath","value":"v^*","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>v</mi><mo>∗</mo></msup></mrow><annotation encoding=\"application/x-tex\">v^*</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6887em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span></span></span></span>","key":"Ho4N7CKXbs"},{"type":"text","value":" through an iterative process that alternates between two main steps:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vZNmm2Wc29"}],"key":"UB316HCDKY"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Policy Evaluation","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"KujcFUUXMn"}],"key":"e2d88RQEnC"},{"type":"text","value":": For a given policy ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"sZeqsMOsw6"},{"type":"inlineMath","value":"\\pi","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span>","key":"CauDmKzNeZ"},{"type":"text","value":", calculate the state-value function ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"AGDLpHGKRV"},{"type":"inlineMath","value":"v_\\pi","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mi>π</mi></msub></mrow><annotation encoding=\"application/x-tex\">v_\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"gJWhoW0gwU"},{"type":"text","value":". This step determines the expected long-term return for each state, assuming the agent follows the current policy ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"KR2GZhTGIa"},{"type":"inlineMath","value":"\\pi","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span>","key":"vz6YIINffl"},{"type":"text","value":".","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"b8LX2bQfBT"}],"key":"zzF02Jbj9p"}],"key":"YYImZFh9fO"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Policy Improvement","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"b62A0lzklp"}],"key":"eKfA3NqDHt"},{"type":"text","value":": Using the value function ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ZWeX0VRK41"},{"type":"inlineMath","value":"v_\\pi","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mi>π</mi></msub></mrow><annotation encoding=\"application/x-tex\">v_\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"DYRLW77yJD"},{"type":"text","value":", find a new, better policy ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dWWZheCTCR"},{"type":"inlineMath","value":"\\pi'","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>π</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\pi&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span>","key":"MpNWyvcRVg"},{"type":"text","value":". This is done by acting greedily with respect to ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bEJsNVQqDz"},{"type":"inlineMath","value":"v_\\pi","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mi>π</mi></msub></mrow><annotation encoding=\"application/x-tex\">v_\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"WY56cg5Hjq"},{"type":"text","value":"—that is, for each state, selecting the action that leads to the highest expected return.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"UKyAkRFH48"}],"key":"lLuGbHBh6D"}],"key":"vUp8BQYaHA"}],"key":"XT8c2E5jQ7"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"This cycle of evaluation and improvement continues until the policy no longer changes, at which point it has converged to the optimal policy.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"C6Q0qdJpYc"}],"key":"k7CtVbINkK"},{"type":"heading","depth":3,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Algorithm","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"YDPXck8jIy"}],"key":"J5uP1sChrz"}],"identifier":"algorithm","label":"Algorithm","html_id":"algorithm-1","implicit":true,"key":"wTbW5oMkN9"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"1. Initialization","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Awiy4IrWcx"}],"key":"CeDJjizMva"}],"key":"qMRoBHpl72"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Initialize a ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"utQAsC9H4h"},{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"policy","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"HRbOQSfhpr"}],"key":"SIj67CiKXJ"},{"type":"text","value":" ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"rNCokTc3fi"},{"type":"inlineMath","value":"\\pi_0(s)","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>π</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\pi_0(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"pGOSBdgbIB"},{"type":"text","value":" arbitrarily for all states ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"gX6Qza7EEY"},{"type":"inlineMath","value":"s \\in S","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>∈</mo><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">s \\in S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>","key":"Z74IbwTs4c"},{"type":"text","value":".","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"ewvUaxUjxt"}],"key":"nonoF619Ux"}],"key":"SLGrdii1xV"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Initialize the ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"X7QgTAetBo"},{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"state-value function","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"JVAICpH09M"}],"key":"TzsuGgPIxS"},{"type":"text","value":" ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"MX6EkayEhp"},{"type":"inlineMath","value":"v(s)","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"Kfq41O2sUK"},{"type":"text","value":" arbitrarily (e.g., zeros).","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"RGTGLWJQcF"}],"key":"gXfS9aIyvB"}],"key":"WQtQ27k2CQ"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Set iteration counter ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"BhYq8XPxPr"},{"type":"inlineMath","value":"k = 0","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">k = 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"SoI30ZSaph"},{"type":"text","value":".","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"vC3Uh28ClQ"}],"key":"Ur6PKutpAl"}],"key":"Ubobfv0aU6"}],"key":"AU84HPkohH"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"2. Policy Evaluation","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"v7joRTC5Hh"}],"key":"rd6CEUb9lt"}],"key":"IZ9D3yW1ad"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Given the current policy ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"xO38JL9w8x"},{"type":"inlineMath","value":"\\pi_k","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>π</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\pi_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"KH2vewGKtA"},{"type":"text","value":", compute its value function ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"PJGm8PfxMO"},{"type":"inlineMath","value":"v^{\\pi_k}","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>v</mi><msub><mi>π</mi><mi>k</mi></msub></msup></mrow><annotation encoding=\"application/x-tex\">v^{\\pi_k}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6644em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>","key":"jEWh1zjhYi"},{"type":"text","value":" by solving the ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"ZbQ6XKBlij"},{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Bellman equation","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"tMsSbbkXiq"}],"key":"Xdy4y8A1uD"},{"type":"text","value":":","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Kq4wibXYAJ"}],"key":"yoelE6N9EY"},{"type":"math","value":"v_{\\pi_k}(s)\n= \\sum_a \\pi_k(a|s)\n  \\Big[\n    r(s,a)\n    + \\gamma \\sum_{s'} p(s'|s,a)\\, v_{\\pi_k}(s')\n  \\Big].","position":{"start":{"line":22,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>v</mi><msub><mi>π</mi><mi>k</mi></msub></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>=</mo><munder><mo>∑</mo><mi>a</mi></munder><msub><mi>π</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mi>a</mi><mi mathvariant=\"normal\">∣</mi><mi>s</mi><mo stretchy=\"false\">)</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"1.8em\" maxsize=\"1.8em\">[</mo><mi>r</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>γ</mi><munder><mo>∑</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></munder><mi>p</mi><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mi mathvariant=\"normal\">∣</mi><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mtext> </mtext><msub><mi>v</mi><msub><mi>π</mi><mi>k</mi></msub></msub><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"1.8em\" maxsize=\"1.8em\">]</mo><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">v_{\\pi_k}(s)\n= \\sum_a \\pi_k(a|s)\n  \\Big[\n    r(s,a)\n    + \\gamma \\sum_{s&#x27;} p(s&#x27;|s,a)\\, v_{\\pi_k}(s&#x27;)\n  \\Big].</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0059em;vertical-align:-0.2559em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2559em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-1.25em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.9em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.25em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"delimsizing size2\">[</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.444em;vertical-align:-1.294em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.856em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6828em;\"><span style=\"top:-2.786em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.294em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2559em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"delimsizing size2\">]</span></span><span class=\"mord\">.</span></span></span></span></span>","enumerator":"7","key":"g1WtgMdyJs"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"We usually ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"H9CXVpXeUq"},{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"solve it iteratively","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"ZzNpnQhkJc"}],"key":"CD69AeBz6b"},{"type":"text","value":" until convergence:","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"EsUfoYC02Y"}],"key":"tqsIbRbXxd"},{"type":"math","value":"v_{i+1}(s)\n\\leftarrow\n\\sum_a \\pi_k(a|s)\n\\Big[\n  r(s,a)\n  + \\gamma \\sum_{s'} p(s'|s,a)\\, v_i(s')\n\\Big].","position":{"start":{"line":33,"column":1},"end":{"line":41,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>v</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>←</mo><munder><mo>∑</mo><mi>a</mi></munder><msub><mi>π</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mi>a</mi><mi mathvariant=\"normal\">∣</mi><mi>s</mi><mo stretchy=\"false\">)</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"1.8em\" maxsize=\"1.8em\">[</mo><mi>r</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>γ</mi><munder><mo>∑</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></munder><mi>p</mi><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mi mathvariant=\"normal\">∣</mi><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mtext> </mtext><msub><mi>v</mi><mi>i</mi></msub><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"1.8em\" maxsize=\"1.8em\">]</mo><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">v_{i+1}(s)\n\\leftarrow\n\\sum_a \\pi_k(a|s)\n\\Big[\n  r(s,a)\n  + \\gamma \\sum_{s&#x27;} p(s&#x27;|s,a)\\, v_i(s&#x27;)\n\\Big].</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-1.25em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.9em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.25em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"delimsizing size2\">[</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.444em;vertical-align:-1.294em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.856em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6828em;\"><span style=\"top:-2.786em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.294em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"delimsizing size2\">]</span></span><span class=\"mord\">.</span></span></span></span></span>","enumerator":"8","key":"OetvPOXH8g"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"Stop when ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"O6mKuKE8gd"},{"type":"inlineMath","value":"\\|v_{i+1} - v_i\\|_\\infty < \\theta","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∥</mi><msub><mi>v</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>v</mi><mi>i</mi></msub><msub><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∞</mi></msub><mo>&lt;</mo><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\|v_{i+1} - v_i\\|_\\infty &lt; \\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∥</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord\">∥</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">∞</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span>","key":"fKqFt3gkGW"},{"type":"text","value":" or when ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"mG4yFjUxLp"},{"type":"inlineMath","value":"i","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span>","key":"zS4IqQNgwh"},{"type":"text","value":" is large than a given value.","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"fgWRDXjRYT"}],"key":"fC0rNYHh0m"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"strong","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"3. Policy Improvement","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"AegPJGmyax"}],"key":"RBGrI6MpXA"}],"key":"HwjOnxEfie"},{"type":"paragraph","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"Update the policy greedily with respect to ","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"hYqwBL42jc"},{"type":"inlineMath","value":"v^{\\pi_k}","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>v</mi><msub><mi>π</mi><mi>k</mi></msub></msup></mrow><annotation encoding=\"application/x-tex\">v^{\\pi_k}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6644em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>","key":"JE5iRwm9EI"},{"type":"text","value":":","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"xC2g0aO7DD"}],"key":"EqvAF1NpVl"},{"type":"math","value":"\\pi_{k+1}(s)\n= \\arg\\max_a\n\\Big[\n  r(s,a)\n  + \\gamma \\sum_{s'} p(s'|s,a)\\, v^{\\pi_k}(s')\n\\Big].","position":{"start":{"line":50,"column":1},"end":{"line":57,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>π</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>arg</mi><mo>⁡</mo><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mi>a</mi></munder><mo fence=\"false\" stretchy=\"true\" minsize=\"1.8em\" maxsize=\"1.8em\">[</mo><mi>r</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>γ</mi><munder><mo>∑</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></munder><mi>p</mi><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mi mathvariant=\"normal\">∣</mi><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mtext> </mtext><msup><mi>v</mi><msub><mi>π</mi><mi>k</mi></msub></msup><mo stretchy=\"false\">(</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"1.8em\" maxsize=\"1.8em\">]</mo><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">\\pi_{k+1}(s)\n= \\arg\\max_a\n\\Big[\n  r(s,a)\n  + \\gamma \\sum_{s&#x27;} p(s&#x27;|s,a)\\, v^{\\pi_k}(s&#x27;)\n\\Big].</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.85em;vertical-align:-0.7em;\"></span><span class=\"mop\">ar<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4306em;\"><span style=\"top:-2.4em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">max</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"delimsizing size2\">[</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.444em;vertical-align:-1.294em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.856em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6828em;\"><span style=\"top:-2.786em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.294em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7144em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"delimsizing size2\">]</span></span><span class=\"mord\">.</span></span></span></span></span>","enumerator":"9","key":"u9WyOaBhf0"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"strong","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"4. Termination Check","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"zmNZ5ZUnmO"}],"key":"r9jjLU4lQW"}],"key":"dGJAzqMtOB"},{"type":"paragraph","position":{"start":{"line":61,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"If ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"g065Yz7Jik"},{"type":"inlineMath","value":"\\pi_{k+1} = \\pi_k","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>π</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>π</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\pi_{k+1} = \\pi_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"PoH1YCzOhs"},{"type":"text","value":" (i.e., policy no longer changes),","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"vTgoJJLi6m"},{"type":"break","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"jqGz6TwVX5"},{"type":"text","value":"then the algorithm has ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"tJ0uus2yT6"},{"type":"strong","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"converged","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"u1iwIK1WTK"}],"key":"ZeitixMoSl"},{"type":"text","value":":","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"RqUG4XyF4r"}],"key":"nA44OJnNQA"},{"type":"math","value":"\\pi^* = \\pi_k,\\quad v^* = v^{\\pi_k}.","position":{"start":{"line":64,"column":1},"end":{"line":66,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>π</mi><mo>∗</mo></msup><mo>=</mo><msub><mi>π</mi><mi>k</mi></msub><mo separator=\"true\">,</mo><mspace width=\"1em\"/><msup><mi>v</mi><mo>∗</mo></msup><mo>=</mo><msup><mi>v</mi><msub><mi>π</mi><mi>k</mi></msub></msup><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">\\pi^* = \\pi_k,\\quad v^* = v^{\\pi_k}.</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7387em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7387em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9331em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7387em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7144em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7144em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mord\">.</span></span></span></span></span>","enumerator":"10","key":"xdd1SWM8bn"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"Otherwise, set ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"WswMewYjgg"},{"type":"inlineMath","value":"k \\leftarrow k+1","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>←</mo><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">k \\leftarrow k+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"vjUDPOlP9k"},{"type":"text","value":" and repeat.","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"YukllTa98Q"}],"key":"rsNgpcOPoD"}],"identifier":"7dad3ad6","label":"7dad3ad6","html_id":"id-7dad3ad6","key":"PHcI79YyzR"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/","height":662},"executionInfo":{"elapsed":324,"status":"ok","timestamp":1763754066766,"user":{"displayName":"Jianguo Zhao","userId":"09996222056778326224"},"user_tz":420},"id":"aad86493","outputId":"52d64426-e35f-4779-f8df-ebd3db331e36"},"children":[{"type":"code","lang":"python","executable":true,"value":"def policy_evaluation(env, Pi, theta, max_iters):\n    \"\"\"\n    Calculates the state-value function V for a given policy Pi.\n    This is an iterative process that applies the Bellman equation until V converges.\n\n    Args:\n        env (GridWorld): The environment.\n        Pi (dict): The policy to evaluate, mapping states to actions.\n        theta (float): Convergence threshold. The loop stops when the max change in V is less than this.\n        max_iters (int): Maximum number of iterations to prevent infinite loops.\n\n    Returns:\n        tuple: A tuple containing:\n            - V (dict): The converged state-value function for the policy Pi.\n            - iters (int): The number of iterations it took to converge.\n    \"\"\"\n    # Initialize the value function V(s) = 0 for all states s.\n    V = {s: 0.0 for s in env.states()}\n\n    iters = 0\n    while True:\n        delta = 0.0  # Tracks the maximum change in V in a single sweep.\n        V_old = V.copy() # Store the old value function for comparison.\n\n        # Loop through each state to update its value.\n        for s in env.states():\n            # Get the action prescribed by the current policy for state s.\n            a = Pi[s]\n\n            # Get the next state and reward for the (s, a) pair.\n            s_next, r = env.step(s, a)\n\n            # Apply the Bellman equation for the given policy:\n            # V(s) = R(s, a) + gamma * V(s_next)\n            # This calculates the expected return from state s by following policy Pi.\n            val = r + env.gamma * V_old[s_next]\n\n            # Update the value for the current state.\n            V[s] = val\n\n            # Check for convergence by tracking the largest change in V.\n            delta = max(delta, abs(val - V_old[s]))\n\n        iters += 1\n        # If the value function has stabilized, or we've hit the max iterations, stop.\n        if delta < theta or iters >= max_iters:\n            break\n\n    return V, iters\n\ndef policy_improvement(env, V):\n    \"\"\"\n    Improves a policy by making it greedy with respect to a given value function V.\n\n    Args:\n        env (GridWorld): The environment.\n        V (dict): The value function to be greedy upon.\n\n    Returns:\n        dict: The new, improved policy.\n    \"\"\"\n    Pi_new = {} # Initialize the new policy.\n\n    # Iterate over all states to find the best action for each.\n    for s in env.states():\n        q_values = {}\n        # For each state, calculate the Q-value for all possible actions.\n        for a in ACTIONS:\n            s_next, r = env.step(s, a)\n            # Q(s, a) = R(s, a) + gamma * V(s_next)\n            q_values[a] = r + env.gamma * V[s_next]\n\n        # The new policy for state s will be the action that maximizes the Q-value.\n        best_a = max(q_values, key=q_values.get)\n        Pi_new[s] = best_a\n\n    return Pi_new\n\ndef policy_iteration(env, theta, max_iters):\n    \"\"\"\n    Performs Policy Iteration to find the optimal policy and value function.\n    It alternates between Policy Evaluation and Policy Improvement until the policy converges.\n\n    Args:\n        env (GridWorld): The environment.\n        theta (float): Convergence threshold for policy evaluation.\n        max_iters (int): Maximum number of policy improvement steps.\n\n    Returns:\n        tuple: A tuple containing:\n            - V (dict): The optimal value function.\n            - Pi (dict): The optimal policy.\n            - iteration (int): The number of policy improvement steps.\n    \"\"\"\n\n    # Start with a random initial policy.\n    # For each state, choose a random action from the set of possible actions.\n    Pi = {s: np.random.choice(ACTIONS) for s in env.states()}\n    iteration = 0\n\n    while True:\n        # Step 1: Policy Evaluation\n        V, _ = policy_evaluation(env, Pi, theta, max_iters)\n\n        # Step 2: Policy Improvement\n        Pi_new = policy_improvement(env, V)\n        iteration += 1\n\n        # Step 3: Termination Check\n        if Pi_new == Pi or iteration >= max_iters:\n            break\n\n        # Update the policy for the next iteration of the main loop.\n        Pi = Pi_new\n\n    # Return the final converged value function, policy, and number of iterations.\n    return V, Pi_new, iteration\n\n# --- Demo Run ---\n# Create a new GridWorld instance for this demonstration.\nenv2 = GridWorld()\n\n# Run the Policy Iteration algorithm.\nV_pi, Pi_pi, iteration = policy_iteration(env2, theta=1e-5, max_iters=1000)\n\n# Print the results and visualize the value function and policy.\nprint(f\"Policy Iteration converged in {iteration} improvement steps.\")\nrender_policy_with_values(env, Pi_pi, V_pi, title=\"Policy and Values\")","identifier":"aad86493-code","enumerator":"5","html_id":"aad86493-code","key":"Rqfbb64i4b"},{"type":"outputs","id":"s9NWRg7jDCvd4N_Bl47eW","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Policy Iteration converged in 6 improvement steps.\n"},"children":[],"identifier":"aad86493-outputs-0","html_id":"aad86493-outputs-0","key":"HISX1m0DXJ"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4d1ab323269ea17aafc0a3d1c97cca05","path":"/4d1ab323269ea17aafc0a3d1c97cca05.png"},"text/plain":{"content":"<Figure size 700x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"aad86493-outputs-1","html_id":"aad86493-outputs-1","key":"BYOavfj6FR"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"(<Figure size 700x600 with 1 Axes>,\n <Axes: title={'center': 'Policy and Values'}>)","content_type":"text/plain"}}},"children":[],"identifier":"aad86493-outputs-2","html_id":"aad86493-outputs-2","key":"r8p8A9pc59"}],"identifier":"aad86493-outputs","html_id":"aad86493-outputs","key":"uyoydTzir6"}],"identifier":"aad86493","label":"aad86493","html_id":"aad86493","key":"eDxUygRLOM"},{"type":"block","kind":"notebook-content","data":{"id":"cd0cf709"},"children":[{"type":"heading","depth":4,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Comparing the Algorithms","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"zPlxSPvHe0"}],"identifier":"comparing-the-algorithms","label":"Comparing the Algorithms","html_id":"comparing-the-algorithms","implicit":true,"key":"MFCH0cpvFH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Value Iteration:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"QvWLbgm0t7"}],"key":"GqGXkCeGFh"}],"key":"MdSOHlZWIk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Performs a single Bellman optimality backup for every state in each iteration. This step simultaneously improves the value estimate and the implicit policy.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jRZv9h8szm"}],"key":"PNiexsywlv"}],"key":"k62tqlX9Wk"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Each iteration is computationally fast, involving a single sweep through the state space.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"sltvex9FuR"}],"key":"nQPrYz2Tjd"}],"key":"GAeVXWVUSw"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It often requires a larger number of iterations to converge compared to the number of policy improvement steps in Policy Iteration.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"qQytqwo310"}],"key":"CLSrTZtpxn"}],"key":"T0LmB9zDL9"}],"key":"NEmlsYUJvm"}],"key":"dUgr1IlE2v"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Policy Iteration:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"EAnVdF6TtA"}],"key":"g0tXEEe8Vb"}],"key":"GzQ0JrOkuE"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Alternates between two distinct steps:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"wdNpk9Ly2R"}],"key":"UtSLwsuac1"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Policy Evaluation:","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"UEDUh6mCx1"}],"key":"S6dtzawQjq"},{"type":"text","value":" Fully computes the value function for the current policy until it converges. This step can be computationally expensive.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VMAaQNAGsh"}],"key":"V2atpSWNUi"}],"key":"krR8i2R05k"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Policy Improvement:","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"aF4tUnOE7B"}],"key":"GfJVrX6fgf"},{"type":"text","value":" Updates the policy to be greedy with respect to the newly computed value function.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"K8LraLXKVj"}],"key":"wgJXWgnC3m"}],"key":"scQoYb8gWS"}],"key":"VAIJ9Ew6HM"}],"key":"s46Ujn1E8m"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It typically converges in fewer overall iterations (policy improvement steps), but each iteration is more computationally intensive due to the full policy evaluation.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"pt5bG3ALjH"}],"key":"Ce0D6h0nkc"}],"key":"I6TeuN3Pz7"}],"key":"pE55FOrCw8"}],"key":"rjxzfyHVvu"}],"key":"BtTCZiCQ1V"}],"identifier":"cd0cf709","label":"cd0cf709","html_id":"cd0cf709","key":"I0Ikr0mEEk"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/","height":645},"executionInfo":{"elapsed":352,"status":"ok","timestamp":1763754092384,"user":{"displayName":"Jianguo Zhao","userId":"09996222056778326224"},"user_tz":420},"id":"8b1cd7f6","outputId":"6f8965c4-0382-4085-c3b5-107020365523"},"children":[{"type":"code","lang":"python","executable":true,"value":"# Quick side-by-side run for the same environment:\nenv_cmp = GridWorld(gamma=0.9)\n\nV_vi, Pi_vi, n_vi = value_iteration(env_cmp, theta=1e-5, max_iters=1000)\nV_pi, Pi_pi, n_pi = policy_iteration(env_cmp, theta=1e-5, max_iters=1000)\n\nprint(f\"Value Iteration: {n_vi} iterations\")\nprint(f\"Policy Iteration: {n_pi} iterations\")\n\nimport matplotlib.pyplot as plt\n\n# Create a figure with two subplots side by side\nfig, axes = plt.subplots(1, 2, figsize=(14, 6))\n\n# Plot Policy from Value Iteration (left subplot)\nrender_policy_with_values(env_cmp, Pi_vi, V_vi, title=\"Value Iteration\", ax=axes[0], show=False)\n\n# Plot Policy from Policy Iteration (right subplot)\nrender_policy_with_values(env_cmp, Pi_pi, V_pi, title=\"Policy Iteration\", ax=axes[1], show=False)\n\nplt.tight_layout()\nplt.show()\n","identifier":"8b1cd7f6-code","enumerator":"6","html_id":"id-8b1cd7f6-code","key":"YH65F2LRBf"},{"type":"outputs","id":"EErjs0C_mc4mTK_nZwns1","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Value Iteration: 133 iterations\nPolicy Iteration: 5 iterations\n"},"children":[],"identifier":"8b1cd7f6-outputs-0","html_id":"id-8b1cd7f6-outputs-0","key":"Jg8TNbLHvE"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"63029c2e6ae4bcf5e72b8cff9f5a30bc","path":"/63029c2e6ae4bcf5e72b8cff9f5a30bc.png"},"text/plain":{"content":"<Figure size 1400x600 with 2 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"8b1cd7f6-outputs-1","html_id":"id-8b1cd7f6-outputs-1","key":"xaDRQcFcZu"}],"identifier":"8b1cd7f6-outputs","html_id":"id-8b1cd7f6-outputs","key":"UoTDDk9mU1"}],"identifier":"8b1cd7f6","label":"8b1cd7f6","html_id":"id-8b1cd7f6","key":"HCNZX7lngj"},{"type":"block","kind":"notebook-content","data":{"id":"d822d98f"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Task 4: Using Gymansium","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FRuOxTA9ND"}],"identifier":"task-4-using-gymansium","label":"Task 4: Using Gymansium","html_id":"task-4-using-gymansium","implicit":true,"key":"DLfAt7GSAs"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We now re-write the grid world environment following the Gymnasium API. Gymnasium provides a standardized API (reset(), step(), render()) that allows seamless integration with popular RL libraries such as ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HP4AtdOcvH"},{"type":"inlineCode","value":"Stable-Baselines3","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FGcROYz7TD"},{"type":"text","value":". As one of the most widely used frameworks in reinforcement learning, Gymnasium offers a common interface shared by countless research projects and benchmarks. Using it ensures that our environment is compatible, reproducible, and easy to compare with other RL studies.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"e6dvdC5Vnd"}],"key":"l1wN86Mo2h"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The Gymnasium API is built around a few core components that define the interaction between an agent and its environment.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NubmPNj0sx"}],"key":"ZaBJUSdufJ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"gym.make(id)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bD29pSdvHz"},{"type":"text","value":": This function creates and initializes an environment specified by its id. It’s the standard entry point for loading any of the built-in or custom-registered environments.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GMZIuwOfzR"}],"key":"IRuhtPcoYe"}],"key":"kHUqJ1DEMT"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"env.reset()","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Ljcsb88w51"},{"type":"text","value":": This method resets the environment to a valid starting state and returns the initial observation. This is called at the beginning of every new episode.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"aKt1vzqAZH"}],"key":"eil1Rvygxq"}],"key":"HamUE6Mc3W"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"inlineCode","value":"env.step(action)","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"DX7VBT2PmF"},{"type":"text","value":": This is the most important method. It executes the agent’s chosen action for one time-step. In return, it provides a tuple of five crucial pieces of information: the next observation, the reward received, a boolean flag indicating if the episode has terminated (e.g., the goal was reached), a boolean flag indicating if the episode was truncated (e.g., a time limit was hit), and a dictionary containing diagnostic info.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"CbaMgp6nry"}],"key":"M18ot9IAyy"}],"key":"KAvhXLckSh"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"inlineCode","value":"env.render()","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ouXxWJxuQ7"},{"type":"text","value":": This method generates a visualization of the environment’s current state. It’s invaluable for watching your agent perform during evaluation or for debugging your code.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"FKorIkeLcc"}],"key":"HIxyTjz5jY"}],"key":"BpCrHUvg2m"}],"key":"mJ0xuit5lP"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Details can be found at ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"rFnZHyPXMA"},{"type":"link","url":"https://gymnasium.farama.org/introduction/basic_usage/","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Basic Usage of Gym","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"iXzDlCPmnP"}],"urlSource":"https://gymnasium.farama.org/introduction/basic_usage/","key":"AJjolg29oP"},{"type":"text","value":".","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"P4WSG0csq0"}],"key":"iS3hHFjwSJ"}],"identifier":"d822d98f","label":"d822d98f","html_id":"d822d98f","key":"WF6x5X8gL4"},{"type":"block","kind":"notebook-content","data":{"id":"PQWrMr-Q4frD"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In Gymnasium, an ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TS4RzBRiad"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"action space","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YiMVQFa9W7"}],"key":"P4aSBVu9an"},{"type":"text","value":" defines what moves or commands an agent can take — for example, in GridWorld, actions are discrete choices such as up, right, down, left, or stay.\nThe ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IFVchtV4U4"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"observation space","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bilA4BKQyE"}],"key":"HKowKFK03P"},{"type":"text","value":" describes what the agent perceives about the environment at each step — in this case, it is the agent’s position on the grid, represented by row and column indices.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YjfSg5J2pp"}],"key":"wzsI07IaJH"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"A ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Cwxzz6A0gR"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Discrete","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"HgCxWjYdmN"}],"key":"NK1RhxxKU4"},{"type":"text","value":" action space means the agent selects one action from a finite set of integers. Discrete(4) means the action can choose from five consecutive integers starting from 0, that is 0~4.  In our grid world environment, 0, 1, 2 , 3, 4 means up, right, down, left, stay, respectively.\nA ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"m0HivHPHlh"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"MultiDiscrete","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VfR00c84q0"}],"key":"Axpc6khLet"},{"type":"text","value":" observation space means the observation or state has multiple integer components, each with its own range — for instance, Discrete([4,4]) means both values can choose from five integers [0~4, 0~4]. In our grid world environment, the two numbers represent the row and column indices of the cell position. For instance, [2,3] means the cell position at row 2 and column 3.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"sTzWpZxHwA"}],"key":"GMILlrQnYP"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The function ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"HXsKRWr3D2"},{"type":"inlineCode","value":"tuple(s_next)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IkueOMETeW"},{"type":"text","value":" converts the NumPy array returned by the environment (like ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"QNd9fixv3v"},{"type":"inlineCode","value":"[2, 3]","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"VQAS5cH0BN"},{"type":"text","value":") into a tuple ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SozuPQ22UV"},{"type":"inlineCode","value":"(2, 3)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"P6400T9VTH"},{"type":"text","value":" so it can be used as a dictionary key when storing or retrieving state values.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"eeKvDcv4oo"}],"key":"X8Kfktgm3W"}],"identifier":"pqwrmr-q4frd","label":"PQWrMr-Q4frD","html_id":"pqwrmr-q4frd","key":"SjHHPt9hUu"},{"type":"block","kind":"notebook-code","data":{"id":"f8ce94e8"},"children":[{"type":"code","lang":"python","executable":true,"value":"try:\n    import gymnasium as gym\nexcept ModuleNotFoundError:\n    import sys\n    !{sys.executable} -m pip install gymnasium\n    import gymnasium as gym\nfrom gymnasium import spaces # spaces are used to define action and observation spaces\nimport numpy as np\n\n# Define the set of possible actions and their visual representations\nACTIONS = [0, 1, 2, 3, 4]  # up, right, down, left, stay\nACTION_ARROWS = {0:\"↑\", 1:\"→\", 2:\"↓\", 3:\"←\", 4:\"*\"}\n\n\nclass GridWorldEnv(gym.Env):\n    \"\"\"Custom GridWorld environment compatible with Gymnasium API.\"\"\"\n    \"\"\"Note that Gymnasium environments are typically implemented as classes that inherit from gym.Env.\n    This allows them to integrate seamlessly with the Gymnasium framework,\n    which provides tools for reinforcement learning research and development.\"\"\"\n    \"\"\"You may compare this class with the one implemented at the beginning as a simple GridWorld class.\n    The only difference is that this class follows the Gymnasium API requirements: it defines action_space and observation_space,\n    and implements reset() and step() methods.\"\"\"\n\n    def __init__(self,\n                 grid_shape=(5, 5),\n                 forbidden=None,\n                 goal=None,\n                 goal_reward=1.0,\n                 step_reward=0.0,\n                 forbidden_reward=-10.0,\n                 boundary_reward=-1.0,\n                 gamma=0.9,\n                 render_mode=None):\n        \"\"\"\n        Initializes the GridWorld environment.\n\n        Args:\n            grid_shape (tuple): The shape of the grid (rows, columns).\n            forbidden (list of tuples): A list of coordinates for forbidden states.\n            goal (tuple): The coordinates of the goal state.\n            goal_reward (float): The reward for reaching the goal.\n            step_reward (float): The reward for a regular step.\n            forbidden_reward (float): The reward for entering a forbidden state.\n            boundary_reward (float): The reward for hitting a boundary.\n            gamma (float): The discount factor for future rewards.\n            render_mode (str, optional): The mode for rendering the environment.\n        \"\"\"\n        super().__init__()\n\n        # Environment parameters\n        self.grid_shape = grid_shape\n        self.forbidden = forbidden if forbidden is not None else [(2,2)]\n        self.goal = goal if goal is not None else (4,4)\n        self.goal_reward = goal_reward\n        self.step_reward = step_reward\n        self.forbidden_reward = forbidden_reward\n        self.boundary_reward = boundary_reward\n        self.gamma = gamma\n        self.render_mode = render_mode\n\n        # Agent's current position, initialized in reset()\n        self.agent_pos = None\n\n        # Define Gymnasium spaces\n        # The action space is discrete with a size equal to the number of actions.\n        self.action_space = spaces.Discrete(len(ACTIONS))\n        # The observation space represents the agent's position on the grid.\n        self.observation_space = spaces.MultiDiscrete(list(grid_shape))\n\n    # -----------------------------------\n    # Helper functions\n    # -----------------------------------\n    def in_bounds(self, s):\n        \"\"\"Check if a state 's' is within the grid boundaries.\"\"\"\n        r, c = s\n        R, C = self.grid_shape\n        return 0 <= r < R and 0 <= c < C\n\n    def is_forbidden(self, s):\n        \"\"\"Check if a state 's' is a forbidden state.\"\"\"\n        return s in self.forbidden\n\n    def states(self):\n        \"\"\"Return a list of all possible states (coordinates) in the grid.\"\"\"\n        valid_states = []\n        R, C = self.grid_shape\n        for r in range(R):\n            for c in range(C):\n                valid_states.append((r,c))\n        return valid_states\n\n    # -----------------------------------\n    # Gymnasium required methods\n    # -----------------------------------\n\n    def reset(self, seed=None, options=None):\n        \"\"\"\n        Reset the environment to its initial state.\n        The agent is placed at the starting position (0,0).\n        Returns the initial observation and an info dictionary.\n        \"\"\"\n        super().reset(seed=seed)\n        self.agent_pos = (0, 0)   # Always start in the top-left corner\n        # The observation is the agent's position as a numpy array.\n        obs = np.array(self.agent_pos, dtype=np.int32)\n        return obs, {}\n\n    def step(self, action):\n        \"\"\"\n        Execute one time step in the environment.\n        The agent takes an action, and the environment transitions to a new state.\n\n        Args:\n            action (int): The action to be taken by the agent.\n\n        Returns:\n            tuple: A tuple containing the new observation, the reward,\n                   a boolean indicating if the episode is terminated,\n                   a boolean indicating if the episode is truncated,\n                   and an info dictionary.\n        \"\"\"\n        assert self.action_space.contains(action), f\"Invalid action {action}\"\n\n        r, c = self.agent_pos\n\n        # Map the action to a new position (nr, nc for new row, new col)\n        if action == 0:    nr, nc = r - 1, c     # up\n        elif action == 1:  nr, nc = r, c + 1     # right\n        elif action == 2:  nr, nc = r + 1, c     # down\n        elif action == 3:  nr, nc = r, c - 1     # left\n        else:              nr, nc = r, c         # stay\n\n        # Check for environment boundaries\n        if not self.in_bounds((nr, nc)):\n            next_pos = self.agent_pos  # Agent stays in the same position\n            reward = self.boundary_reward\n        else:\n            # The new position is valid\n            next_pos = (nr, nc)\n            # Assign reward based on the new state\n            if next_pos == self.goal:\n                reward = self.goal_reward\n            elif self.is_forbidden(next_pos):\n                reward = self.forbidden_reward\n            else:\n                reward = self.step_reward\n\n        # Update the agent's position\n        self.agent_pos = next_pos\n\n        # Prepare the return values\n        obs = np.array(self.agent_pos, dtype=np.int32)\n\n        # In this simple environment, an episode never terminates or gets truncated on its own.\n        # This would be different in environments with terminal states or time limits.\n        terminated, truncated, info = False, False, {}\n\n        return obs, reward, terminated, truncated, info","identifier":"f8ce94e8-code","enumerator":"7","html_id":"f8ce94e8-code","key":"QjAzoTZrs3"},{"type":"outputs","id":"mwqGuKEmz1bmTRiawcrTZ","children":[],"identifier":"f8ce94e8-outputs","html_id":"f8ce94e8-outputs","key":"KTptS8XkRx"}],"identifier":"f8ce94e8","label":"f8ce94e8","html_id":"f8ce94e8","key":"LqcE6pQTAA"},{"type":"block","kind":"notebook-content","data":{"id":"l8qPFYHgyl1-"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, let’s implement the value iteration algorithm based on this Gymnaiusm-style grid world environment. The policy iteration algorithm is left as an exercise.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z1GWJsOvXS"}],"key":"Yx3mZh11Ub"}],"identifier":"l8qpfyhgyl1-","label":"l8qPFYHgyl1-","html_id":"l8qpfyhgyl1","key":"M3yokTlDFe"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/","height":662},"executionInfo":{"elapsed":171,"status":"ok","timestamp":1763754461049,"user":{"displayName":"Jianguo Zhao","userId":"09996222056778326224"},"user_tz":420},"id":"TGilX48dyhg2","outputId":"0326a2d1-ed35-4e4f-b08e-8c135b0ab019"},"children":[{"type":"code","lang":"python","executable":true,"value":"def value_iteration_gym(env, theta, max_iters):\n    \"\"\"\n    Performs Value Iteration for a Gymnasium-based GridWorld environment.\n    This implementation is similar to the one in Task 2.\n\n    Args:\n        env (GridWorldEnv): The Gymnasium-style GridWorld environment.\n        theta (float): A small threshold for determining convergence.\n        max_iters (int): The maximum number of iterations.\n\n    Returns:\n        tuple: A tuple containing:\n            - V (dict): The optimal value function.\n            - Pi (dict): The optimal policy.\n            - iters (int): The number of iterations until convergence.\n    \"\"\"\n    # Initialization\n    states = env.states()\n    V = {s: 0.0 for s in states}\n    Pi = {s: 0 for s in states}  # Arbitrary initial policy\n    iters = 0\n\n    while True:\n        delta = 0.0\n        V_old = V.copy()  # Store the value function from the previous iteration\n\n        # Loop over all states\n        for s in states:\n            q_values = {}\n            # Calculate the q-value for each action in the current state\n            for a in ACTIONS:\n                # The Gym env is stateful, so we need to set its position to the state 's' we are evaluating\n                env.agent_pos = s\n                # The step function returns the next state and reward\n                s_next_arr, r, _, _, _ = env.step(a)\n                s_next = tuple(s_next_arr) # Convert numpy array to tuple for dict key\n\n                # Bellman update using the value function from the *previous* iteration\n                q_values[a] = r + env.gamma * V_old[s_next]\n\n            # Find the best action and its value\n            best_action = max(q_values, key=q_values.get)\n            best_value = q_values[best_action]\n\n            # Update the value function and policy for the current state\n            V[s] = best_value\n            Pi[s] = best_action\n\n            # Track the maximum change in the value function for convergence check\n            delta = max(delta, abs(V[s] - V_old[s]))\n\n        iters += 1\n        # Check for convergence\n        if delta < theta or iters >= max_iters:\n            break\n\n    return V, Pi, iters\n\n# ---- Demo Run ----\nenv = GridWorldEnv()\nV_vi, Pi_vi, n_vi = value_iteration_gym(env, theta=1e-3, max_iters=1000)\nprint(f\"Value Iteration converged in {n_vi} iterations.\")\nrender_policy_with_values(env, Pi_vi, V_vi, title=\"Policy and Values\")","identifier":"tgilx48dyhg2-code","enumerator":"8","html_id":"tgilx48dyhg2-code","key":"stWg6Bk1PA"},{"type":"outputs","id":"KGlNHZ3bZKS94fYyye_UD","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Value Iteration converged in 67 iterations.\n"},"children":[],"identifier":"tgilx48dyhg2-outputs-0","html_id":"tgilx48dyhg2-outputs-0","key":"LcSEoSMyoe"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"eabba94aedfa6cce7b28482a179e894d","path":"/eabba94aedfa6cce7b28482a179e894d.png"},"text/plain":{"content":"<Figure size 700x600 with 1 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"tgilx48dyhg2-outputs-1","html_id":"tgilx48dyhg2-outputs-1","key":"jQn2rs2ADx"},{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"(<Figure size 700x600 with 1 Axes>,\n <Axes: title={'center': 'Policy and Values'}>)","content_type":"text/plain"}}},"children":[],"identifier":"tgilx48dyhg2-outputs-2","html_id":"tgilx48dyhg2-outputs-2","key":"HulZuutLSh"}],"identifier":"tgilx48dyhg2-outputs","html_id":"tgilx48dyhg2-outputs","key":"IXh2abrk0e"}],"identifier":"tgilx48dyhg2","label":"TGilX48dyhg2","html_id":"tgilx48dyhg2","key":"QnV93oVk7v"},{"type":"block","kind":"notebook-content","data":{"id":"b2fb4217"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"HW Problems","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"NNV1NTaqib"}],"identifier":"hw-problems","label":"HW Problems","html_id":"hw-problems","implicit":true,"key":"UTd86QXBM2"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Value Iteration Manual derivation","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"tIbYurp54m"}],"key":"Ca3w9YUGo5"},{"type":"text","value":": Consider a 2×2 grid world with the following configuration:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"wYD1089Qbm"}],"key":"GI4zvggXbT"},{"type":"table","position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[],"key":"nsB8JdSWDA"},{"type":"tableCell","header":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"0","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vbdHczSZLn"}],"key":"uoeI9pqLMl"},{"type":"tableCell","header":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"1","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"yZX0edQWYP"}],"key":"ApcB8DAzZv"}],"key":"tQycehHfNk"},{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"0","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"rvCVNW2ETT"}],"key":"JUciLzmqKv"}],"key":"iyt1W5Y40z"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"[   ]","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"xjqzBRbGLF"}],"key":"A6rH9koqH8"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"[ G ]","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"SPsKoPVj84"}],"key":"C7QcfivdSz"}],"key":"cXmbZlOPzP"},{"type":"tableRow","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"1","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"nnaKwjYVSa"}],"key":"oNfvJWFNcS"}],"key":"zl8fHKwuLj"},{"type":"tableCell","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"[   ]","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lVfMm9xXYQ"}],"key":"x2eR8vCK7y"},{"type":"tableCell","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"[ X ]","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qBOSBpzDT5"}],"key":"B95REGcO8a"}],"key":"wbM4TdS8Mc"}],"key":"YMHwh7Uijq"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Goal state: (0,1) - marked with “G”","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"KTOcC7AMT4"}],"key":"MNCLFCkWFX"}],"key":"KTx9xM9b5m"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Forbidden state: (1,1) - marked with “X”","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"gYtK1xQ0l6"}],"key":"Kd5FCEq04V"}],"key":"fQwSBhPmBz"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Rewards:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"yNJz14IAdm"}],"key":"bBUMq56O9u"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"goal_reward = 10.0 (for reaching the goal)","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"m0KCsi9efO"}],"key":"TYSXw9eBAX"}],"key":"txFLpWjjWC"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"step_reward = -0.1 (small penalty for each step)","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"wXvCpZkrHU"}],"key":"U5SLkTx3uK"}],"key":"vaJVozcD9x"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"forbidden_reward = -5.0 (penalty for entering forbidden state)","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"zreEmtLx80"}],"key":"dgRjyAFpDb"}],"key":"JBFSXRcTyp"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"boundary_reward = -1.0 (penalty for hitting boundary)","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"nfykf0Q4Nq"}],"key":"ZOSQK1NXep"}],"key":"pIlHoA6jkn"}],"key":"THE9G7C8E6"}],"key":"B2twuxb5Q2"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Discount factor: gamma = 0.9","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Vag0daFCvy"}],"key":"Tdlc0D9vd4"}],"key":"H854D0LpXv"}],"key":"QA0yloT8G2"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Assume we have five actions for each state similar to the example we discussed in lectures. Manually perform Value Iteration to find the optimal value function ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"YSl6uoaMsP"},{"type":"inlineMath","value":"v(s)","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"GHD655gxtd"},{"type":"text","value":" and optimal policy ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"dvKY2T7Q0A"},{"type":"inlineMath","value":"\\pi(s)","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>π</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\pi(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"UlFahlbZTs"},{"type":"text","value":" for all states. Show the details steps.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"QsNzKwe96C"}],"key":"sqQcSJoG5o"}],"key":"OJhvdCSJqP"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"strong","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Policy Iteration Manual derivation","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"PZ0u7euv0T"}],"key":"VyTSnXKt2j"},{"type":"text","value":": consider a 1x2 grid world with the following configuration:","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ICN9PX9I2g"}],"key":"tTXgPILNQ5"},{"type":"table","position":{"start":{"line":23,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[],"key":"koD07KckSI"},{"type":"tableCell","header":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"0","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"XzQszuRQnq"}],"key":"zpQ58xeVWa"},{"type":"tableCell","header":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"1","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"aoTYr1HOBS"}],"key":"nR8M4Z7fBH"}],"key":"rAhKbnHxZc"},{"type":"tableRow","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"strong","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"0","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"LQWLFIwwub"}],"key":"Yhz65oEHue"}],"key":"ThmdYeHMWh"},{"type":"tableCell","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"[ G ]","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"B2S48Bxb7g"}],"key":"hUDtKLnap0"},{"type":"tableCell","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"[  ]","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"OSkbIEvCTn"}],"key":"on94g6jCQS"}],"key":"s4QU42GJFL"}],"key":"Ow4mr3VTj0"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":26,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Goal state: (0,0) - marked with “G”","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"p8LKSAnhAE"}],"key":"pQ0dxQTHdV"}],"key":"EwuIMiE5mC"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Rewards:","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"jBYQty22h0"}],"key":"iTLoHBEZA6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":28,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"goal_reward = 5.0 (for reaching the goal)","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"gIkScT0a9t"}],"key":"eBZF8oPGkj"}],"key":"mS0vdvysk5"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"step_reward = -0.1 (small penalty for each step)","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"YSzBzwNyai"}],"key":"QhyMssk8Wb"}],"key":"vMQ24UnGfK"},{"type":"listItem","spread":true,"position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"boundary_reward = -1.0 (penalty for hitting boundary)","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"K6atOaTPUR"}],"key":"R2GIcqKBKs"}],"key":"G1KLgJvPAS"}],"key":"xvI7V8uxS7"}],"key":"JSlEEQcRDo"},{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Discount factor: gamma = 0.9","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"zIKwdF1AQh"}],"key":"HAnJyFtceu"}],"key":"qG3tNXeAEI"}],"key":"psPZ4AS1Il"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Assume we have three actions ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"urq4iTKDu9"},{"type":"inlineMath","value":"a_l","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>l</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"Jq1JZxW7BB"},{"type":"text","value":", ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"gHykcrZ5br"},{"type":"inlineMath","value":"a_0","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">a_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"CzMWBTjq4p"},{"type":"text","value":", and ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"OD41b2Qww1"},{"type":"inlineMath","value":"a_r","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>r</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"wUxFnOBeMa"},{"type":"text","value":" for moving left, stay, and moving right. Manually perform Policy Iteration to find the optimal value function ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"irpECmJbpp"},{"type":"inlineMath","value":"v(s)","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"B8vtNOhMqQ"},{"type":"text","value":" and optimal policy ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"mnR3iaF5wf"},{"type":"inlineMath","value":"\\pi(s)","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>π</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\pi(s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>","key":"NxnO29ff72"},{"type":"text","value":" for all states. ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"HkLaZ20cFb"},{"type":"strong","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Assuming an initial policy that will both move to the right","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"xLNP2rZ9LZ"}],"key":"EZCzHhSz6t"},{"type":"text","value":".  Show the details steps (note that in the policy evaluation step, you can directly calculate the state values instead of using iterative method).","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"HCvwPveuUM"}],"key":"T4zQ6jU2eo"}],"key":"ciaNtQupfo"},{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"strong","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Truncated Policy Evaluation","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"EU8alXn7pN"}],"key":"T9qty6DdiY"},{"type":"text","value":": Modify ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"fFyDgPVjxT"},{"type":"inlineCode","value":"policy_evaluation","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"CXnIuKRKhi"},{"type":"text","value":" in Task 3 so it runs for a fixed number of inner sweeps, denoted by ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"VyvRmvg4XO"},{"type":"inlineCode","value":"j_trunc","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"GbytnDJs75"},{"type":"text","value":", instead of until full convergence. Implement Policy Iteration using this truncated evaluation (often called Approximate Policy Iteration) for ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"JIWJa0V9KG"},{"type":"inlineCode","value":"j_trunc = 2, 5, 10","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"adwbA0hIxs"},{"type":"text","value":". For each setting:","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"DbsuidfJOe"}],"key":"WE9ZkpxnI3"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Run until the outer policy no longer changes (or a reasonable cap on outer iterations is reached).","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"cScg4tVLvo"}],"key":"gnQlTDmM8h"}],"key":"JyGvB6mKq0"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Record: (a) number of outer policy improvement steps, (b) final value function for all states, (c) max absolute difference between the final truncated value function and the fully converged value function obtained with the original (non-truncated) method.","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"aj3uB2XTw1"}],"key":"tCgboZMMP4"}],"key":"fLDxd1aGmC"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Plot the resulting greedy policy and state values for each ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"XuziWUgleE"},{"type":"inlineCode","value":"j_trunc","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"qxenIWccQ2"},{"type":"text","value":" side by side.","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"UsXGku8wei"}],"key":"bQaEwNbDBS"}],"key":"tI6qGZXmpH"}],"key":"VY7xdxiqkr"},{"type":"paragraph","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"Explain:","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"SIDkJmuk8P"}],"key":"bk5GGWdzuQ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":41,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"How increasing ","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"VyFpCsjodz"},{"type":"inlineCode","value":"j_trunc","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"QwhPs7zH14"},{"type":"text","value":" affects accuracy vs. computation time.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"b01b8lPBCu"}],"key":"k8nmvnqduv"}],"key":"VUqfX43BGC"},{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Why smaller ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"x11IAyXv9n"},{"type":"inlineCode","value":"j_trunc","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"izBCd622FT"},{"type":"text","value":" may lead to more outer iterations.","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"apGmZ38WOg"}],"key":"NpZEgAHTE9"}],"key":"JOqzIo62Iu"},{"type":"listItem","spread":true,"position":{"start":{"line":43,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The trade-off between faster (less accurate) evaluation and slower (more accurate) evaluation in achieving the optimal policy.","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"jUqirGCddD"}],"key":"Il16aEa8O7"}],"key":"HyAgeI7d8d"}],"key":"IVCSetKzLd"}],"key":"poDvPOVVir"},{"type":"listItem","spread":true,"position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"strong","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"Policy iteration based on Gymnasium environment","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"enZVkjHgHy"}],"key":"jk3K8YSxhg"},{"type":"text","value":": Implement policy iteration in Task 4, using the Gymnasium-based grid world environment. Plot the final results.","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"LGYOCbM8QM"}],"key":"Vk66mIJJll"}],"key":"QIuo4hEX1W"}],"key":"GuMY6Byu77"}],"identifier":"b2fb4217","label":"b2fb4217","html_id":"b2fb4217","key":"T0gQCoDsM9"}],"key":"T1boclWLfx"},"references":{"cite":{"order":[],"data":{}}}}