{"version":3,"kind":"Notebook","sha256":"ad0137281eb0a4de451bb083727120b1dc6a45ad0dbdd28d1365107c17e3ba09","slug":"lab8-model-predictive-control","location":"/Lab8 - Model Predictive Control.ipynb","dependencies":[],"frontmatter":{"title":"Lab8: Model Predictive Control","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Jianguo Zhao","given":"Jianguo","family":"Zhao"},"name":"Jianguo Zhao","affiliations":["Department of Mechanical Engineering, Colorado State University"],"id":"contributors-Users\\jguoz\\OneDrive - Colostate\\Teaching\\MECH 529 Advanced Mechanical Systems\\2025 Fall\\Lab\\All Labs\\myst-generated-uid-0"}],"github":"https://github.com/YOUR_USERNAME/YOUR_REPO","copyright":"2025","affiliations":[{"id":"Department of Mechanical Engineering, Colorado State University","name":"Department of Mechanical Engineering, Colorado State University"}],"exports":[{"format":"ipynb","filename":"Lab8 - Model Predictive Control.ipynb","url":"/Lab8 - Model Predict-666be886778f6ed1c7deb0f4f98ed849.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"id":"9d41c333"},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This lab is modified from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dZY9yPmTcX"},{"type":"link","url":"https://colab.research.google.com/drive/1AufRjpbdKcOEoWO5NEiczF3C8Rc4JuTL","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"notebook by Prof. Richard Murray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"h4YjxCivni"}],"urlSource":"https://colab.research.google.com/drive/1AufRjpbdKcOEoWO5NEiczF3C8Rc4JuTL","key":"onx7hFl6j6"}],"key":"RXzJeYyoM3"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This lab introduces Model Predictive Control (MPC). We will start by implementing a continuous-time MPC for a double integrator system and compare its performance against a standard LQR controller. We will then explore a discrete-time MPC implementation for the same system.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aUczpYY7HR"}],"key":"MWjqbyzb7p"}],"identifier":"9d41c333","label":"9d41c333","html_id":"id-9d41c333","key":"gB7KVVjHe7"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8559,"status":"ok","timestamp":1761933568032,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"4fe0af7f","outputId":"d4d64896-e644-46af-da8f-6614fa8b6b0d"},"children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport scipy as sp\nimport matplotlib.pyplot as plt\nimport time\ntry:\n  import control as ctl\n  print(\"python-control\", ctl.__version__)\nexcept ImportError:\n  !pip install control\n  import control as ctl\nimport control.optimal as opt\nimport control.flatsys as fs","identifier":"4fe0af7f-code","enumerator":"1","html_id":"id-4fe0af7f-code","key":"Gx7Io2fW1z"},{"type":"outputs","id":"eNIkgFFZiljRFiXImu7mc","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Collecting control\n  Downloading control-0.10.2-py3-none-any.whl.metadata (7.6 kB)\nRequirement already satisfied: numpy>=1.23 in /usr/local/lib/python3.12/dist-packages (from control) (2.0.2)\nRequirement already satisfied: scipy>=1.8 in /usr/local/lib/python3.12/dist-packages (from control) (1.16.3)\nRequirement already satisfied: matplotlib>=3.6 in /usr/local/lib/python3.12/dist-packages (from control) (3.10.0)\nRequirement already satisfied: contourpy>=1.0.1 in /usr/local/lib/python3.12/dist-packages (from matplotlib>=3.6->control) (1.3.3)\nRequirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.12/dist-packages (from matplotlib>=3.6->control) (0.12.1)\nRequirement already satisfied: fonttools>=4.22.0 in /usr/local/lib/python3.12/dist-packages (from matplotlib>=3.6->control) (4.60.1)\nRequirement already satisfied: kiwisolver>=1.3.1 in /usr/local/lib/python3.12/dist-packages (from matplotlib>=3.6->control) (1.4.9)\nRequirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.12/dist-packages (from matplotlib>=3.6->control) (25.0)\nRequirement already satisfied: pillow>=8 in /usr/local/lib/python3.12/dist-packages (from matplotlib>=3.6->control) (11.3.0)\nRequirement already satisfied: pyparsing>=2.3.1 in /usr/local/lib/python3.12/dist-packages (from matplotlib>=3.6->control) (3.2.5)\nRequirement already satisfied: python-dateutil>=2.7 in /usr/local/lib/python3.12/dist-packages (from matplotlib>=3.6->control) (2.9.0.post0)\nRequirement already satisfied: six>=1.5 in /usr/local/lib/python3.12/dist-packages (from python-dateutil>=2.7->matplotlib>=3.6->control) (1.17.0)\nDownloading control-0.10.2-py3-none-any.whl (578 kB)\n\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m578.3/578.3 kB\u001b[0m \u001b[31m5.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n\u001b[?25hInstalling collected packages: control\nSuccessfully installed control-0.10.2\n"},"children":[],"identifier":"4fe0af7f-outputs-0","html_id":"id-4fe0af7f-outputs-0","key":"dd1tDrQV5g"}],"identifier":"4fe0af7f-outputs","html_id":"id-4fe0af7f-outputs","key":"syn2XvTXGe"}],"identifier":"4fe0af7f","label":"4fe0af7f","html_id":"id-4fe0af7f","key":"W1oWXvrDDZ"},{"type":"block","kind":"notebook-content","data":{"id":"1fd3d43b"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"System definition for Double Integrator","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NVnkIYxVyP"}],"identifier":"system-definition-for-double-integrator","label":"System definition for Double Integrator","html_id":"system-definition-for-double-integrator","implicit":true,"key":"YEKaRjT6yD"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To illustrate the implementation of a model predictive controller, we consider a linear system corresponding to a double integrator with bounded input:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zMmaazIxxB"}],"key":"XlS3XksO5B"},{"type":"math","value":"\\dot x = \\begin{bmatrix} 0 & 1 \\\\ 0 & 0 \\end{bmatrix} x + \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix} \\text{clip}(u)\n  \\qquad\\text{where}\\qquad\n  \\text{clip}(u) = \\begin{cases}\n    -1 & u < -1, \\\\\n    u & -1 \\leq u \\leq 1, \\\\\n    1 & u > 1.\n  \\end{cases}","position":{"start":{"line":5,"column":1},"end":{"line":13,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mover accent=\"true\"><mi>x</mi><mo>˙</mo></mover><mo>=</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mi>x</mi><mo>+</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mtext>clip</mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo stretchy=\"false\">)</mo><mspace width=\"2em\"/><mtext>where</mtext><mspace width=\"2em\"/><mtext>clip</mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.36em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>u</mi><mo>&lt;</mo><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>u</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mn>1</mn><mo>≤</mo><mi>u</mi><mo>≤</mo><mn>1</mn><mo separator=\"true\">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>u</mi><mo>&gt;</mo><mn>1.</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding=\"application/x-tex\">\\dot x = \\begin{bmatrix} 0 &amp; 1 \\\\ 0 &amp; 0 \\end{bmatrix} x + \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix} \\text{clip}(u)\n  \\qquad\\text{where}\\qquad\n  \\text{clip}(u) = \\begin{cases}\n    -1 &amp; u &lt; -1, \\\\\n    u &amp; -1 \\leq u \\leq 1, \\\\\n    1 &amp; u &gt; 1.\n  \\end{cases}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6679em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1111em;\"><span class=\"mord\">˙</span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">clip</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord text\"><span class=\"mord\">where</span></span><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord text\"><span class=\"mord\">clip</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:4.32em;vertical-align:-1.91em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.35em;\"><span style=\"top:-2.2em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎩</span></span></span><span style=\"top:-2.192em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span style=\"height:0.316em;width:0.8889em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.8889em' height='0.316em' style='width:0.8889em' viewBox='0 0 888.89 316' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V316 H384z M384 0 H504 V316 H384z'/></svg></span></span><span style=\"top:-3.15em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎨</span></span></span><span style=\"top:-4.292em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span style=\"height:0.316em;width:0.8889em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='0.8889em' height='0.316em' style='width:0.8889em' viewBox='0 0 888.89 316' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V316 H384z M384 0 H504 V316 H384z'/></svg></span></span><span style=\"top:-4.6em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎧</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.85em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.41em;\"><span style=\"top:-4.41em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span><span style=\"top:-2.97em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span></span></span><span style=\"top:-1.53em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.91em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.41em;\"><span style=\"top:-4.41em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span></span></span><span style=\"top:-2.97em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span></span></span><span style=\"top:-1.53em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">1.</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.91em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"1","key":"NjaJWVjSlJ"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"We implement a model predictive controller by choosing","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"NLqo5zR5xp"}],"key":"I0qHgWNh7D"},{"type":"math","value":"Q_x = \\begin{bmatrix} 1 & 0 \\\\ 0 & 0 \\end{bmatrix}, \\qquad\n  Q_u = \\begin{bmatrix} 1 \\end{bmatrix}, \\qquad\n  P_1 = \\begin{bmatrix} 0.1 & 0 \\\\ 0 & 0.1 \\end{bmatrix}.","position":{"start":{"line":17,"column":1},"end":{"line":21,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>Q</mi><mi>x</mi></msub><mo>=</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mo separator=\"true\">,</mo><mspace width=\"2em\"/><msub><mi>Q</mi><mi>u</mi></msub><mo>=</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mo separator=\"true\">,</mo><mspace width=\"2em\"/><msub><mi>P</mi><mn>1</mn></msub><mo>=</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0.1</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0.1</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">Q_x = \\begin{bmatrix} 1 &amp; 0 \\\\ 0 &amp; 0 \\end{bmatrix}, \\qquad\n  Q_u = \\begin{bmatrix} 1 \\end{bmatrix}, \\qquad\n  P_1 = \\begin{bmatrix} 0.1 &amp; 0 \\\\ 0 &amp; 0.1 \\end{bmatrix}.</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2em;vertical-align:-0.35em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size1\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.85em;\"><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.35em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size1\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0.1</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0.1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">.</span></span></span></span></span>","enumerator":"2","key":"eWEGtQJiSc"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"The system can be defined as follows.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"t4rvetVLEe"}],"key":"t9cY5MFK8t"}],"identifier":"1fd3d43b","label":"1fd3d43b","html_id":"id-1fd3d43b","key":"ahMFH4QgHE"},{"type":"block","kind":"notebook-code","data":{"executionInfo":{"elapsed":3,"status":"ok","timestamp":1761933568037,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"5c01f571"},"children":[{"type":"code","lang":"python","executable":true,"value":"def doubleint_update(t, x, u, params):\n    # Get the parameters\n    lb = params.get('lb', -1)\n    ub = params.get('ub', 1)\n    assert lb < ub\n\n    # bound the input\n    u_clip = np.clip(u, lb, ub)\n\n    return np.array([x[1], u_clip[0]])\n\nproc = ctl.nlsys(\n    doubleint_update, None, name=\"double integrator\",\n    inputs = ['u'], outputs=['x[0]', 'x[1]'], states=2)","identifier":"5c01f571-code","enumerator":"2","html_id":"id-5c01f571-code","key":"PtFTSEf25m"},{"type":"outputs","id":"FCwSlGtJgSeYVDmyXUe_O","children":[],"identifier":"5c01f571-outputs","html_id":"id-5c01f571-outputs","key":"dayhhPDRPQ"}],"identifier":"5c01f571","label":"5c01f571","html_id":"id-5c01f571","key":"g9xqmI5djD"},{"type":"block","kind":"notebook-content","data":{"id":"6c2f0d00"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Task 1: Continous time MPC","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VSlHkyFxa4"}],"identifier":"task-1-continous-time-mpc","label":"Task 1: Continous time MPC","html_id":"task-1-continous-time-mpc","implicit":true,"key":"ZiCxrcN140"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We will first implement a continous time MPC for the system.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CidSEDPoqX"}],"key":"Ls0uTwbjDv"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Problem Setup","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"REQ5oUcAgq"}],"identifier":"problem-setup","label":"Problem Setup","html_id":"problem-setup","implicit":true,"key":"iAoESmUXia"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"To define a MPC controller, we first need to create an optimal control problem (using the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DbV06Gm3vq"},{"type":"inlineCode","value":"OptimalControlProblem","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"r5hkgaHvbk"},{"type":"text","value":" class) and then use the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FuyQJV7kUK"},{"type":"inlineCode","value":"compute_trajectory","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"XH2xrC8pCZ"},{"type":"text","value":" method to solve for the trajectory from the current state. This ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bpMj2ks4tS"},{"type":"inlineCode","value":"compute_trajectory","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DwrzNPMbdJ"},{"type":"text","value":" method is the same as the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Ug4b87URIc"},{"type":"inlineCode","value":"ocp_solve","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"LLlUpovLYk"},{"type":"text","value":" we played with in Lab 7.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"s70oWfNDOW"}],"key":"Mx2PfdB2kQ"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"We start by defining the cost functions, which consists of a trajectory cost (or integral cost) and a terminal cost:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"rI2Rlf5ALS"}],"key":"mIQ2BAylkL"}],"identifier":"6c2f0d00","label":"6c2f0d00","html_id":"id-6c2f0d00","key":"RkNYTpdyCb"},{"type":"block","kind":"notebook-code","data":{"executionInfo":{"elapsed":1,"status":"ok","timestamp":1761933568046,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"a501efef"},"children":[{"type":"code","lang":"python","executable":true,"value":"Qx = np.diag([1, 0])            # weight matrix for state cost\nQu = np.diag([1])               # weight matrix for input cost\ntraj_cost=opt.quadratic_cost(proc, Qx, Qu)\n\nP1 = np.diag([0.1, 0.1])        # weight matrix for terminal cost\nterm_cost = opt.quadratic_cost(proc, P1, None)","identifier":"a501efef-code","enumerator":"3","html_id":"a501efef-code","key":"oTQGYvKwMv"},{"type":"outputs","id":"XAxqXCfcMZfMB77gddIgw","children":[],"identifier":"a501efef-outputs","html_id":"a501efef-outputs","key":"a6Q9fNkXPb"}],"identifier":"a501efef","label":"a501efef","html_id":"a501efef","key":"TpJ9NgUIKX"},{"type":"block","kind":"notebook-content","data":{"id":"c5470629"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We also set up a set of constraints that correspond to the fact that the input should be less than 1.  This can be done using either the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZOyjuGmi2t"},{"type":"link","url":"https://python-control.readthedocs.io/en/0.9.3.post2/generated/control.optimal.input_range_constraint.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"input_range_constraint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lpG3zYjdVl"}],"urlSource":"https://python-control.readthedocs.io/en/0.9.3.post2/generated/control.optimal.input_range_constraint.html","key":"pkmV7zxMvr"},{"type":"text","value":" function or the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SdvJQPvw2W"},{"type":"link","url":"https://python-control.readthedocs.io/en/0.9.3.post2/generated/control.optimal.input_poly_constraint.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"input_poly_constraint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SjnEhoMhbq"}],"urlSource":"https://python-control.readthedocs.io/en/0.9.3.post2/generated/control.optimal.input_poly_constraint.html","key":"G4GZH4OY73"},{"type":"text","value":" function.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JOJNSwvbKJ"}],"key":"dS6wUNz4gF"}],"identifier":"c5470629","label":"c5470629","html_id":"c5470629","key":"UeFZlEfcEi"},{"type":"block","kind":"notebook-code","data":{"executionInfo":{"elapsed":1,"status":"ok","timestamp":1761933568048,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"cb4c511a"},"children":[{"type":"code","lang":"python","executable":true,"value":"traj_constraints = opt.input_range_constraint(proc, -1, 1)\n# traj_constraints = opt.input_poly_constraint(\n#     proc, np.array([[1], [-1]]),  np.array([1, 1]))","identifier":"cb4c511a-code","enumerator":"4","html_id":"cb4c511a-code","key":"okJduwqosm"},{"type":"outputs","id":"3l0nt6obHEtS1whQWuJGb","children":[],"identifier":"cb4c511a-outputs","html_id":"cb4c511a-outputs","key":"d3ysM6dkLv"}],"identifier":"cb4c511a","label":"cb4c511a","html_id":"cb4c511a","key":"UsRraKisNP"},{"type":"block","kind":"notebook-content","data":{"id":"a5568374"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We define the horizon for evaluating finite-time, optimal control by setting up a set of time points across the designed horizon.  The input will be computed at each time point.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ihkD3LB2nZ"}],"key":"swiMUxsz2c"}],"identifier":"a5568374","label":"a5568374","html_id":"a5568374","key":"HjYhO3vReF"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8,"status":"ok","timestamp":1761933568057,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"9edec673","outputId":"63f657b9-5248-438c-b942-69370ae602b2"},"children":[{"type":"code","lang":"python","executable":true,"value":"Th = 5  # horizon length: this is how far ahead we plan for each repetition of the MPC\ntimepts = np.linspace(0, Th, 11, endpoint=True)\nprint(timepts)","identifier":"9edec673-code","enumerator":"5","html_id":"id-9edec673-code","key":"Ih876PxuAx"},{"type":"outputs","id":"R25Nl4sBsAbora_wPLbSw","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"[0.  0.5 1.  1.5 2.  2.5 3.  3.5 4.  4.5 5. ]\n"},"children":[],"identifier":"9edec673-outputs-0","html_id":"id-9edec673-outputs-0","key":"RwldoSRqoK"}],"identifier":"9edec673-outputs","html_id":"id-9edec673-outputs","key":"iwHoRONlDP"}],"identifier":"9edec673","label":"9edec673","html_id":"id-9edec673","key":"r3paLZTrQy"},{"type":"block","kind":"notebook-content","data":{"id":"cb8fcecc"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, we define the optimal control problem that we want to solve (without actually solving it).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nrRbm9OVSa"}],"key":"DbFgN0yTHr"}],"identifier":"cb8fcecc","label":"cb8fcecc","html_id":"cb8fcecc","key":"a2shI6l70K"},{"type":"block","kind":"notebook-code","data":{"executionInfo":{"elapsed":63,"status":"ok","timestamp":1761933568127,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"e9f31be6"},"children":[{"type":"code","lang":"python","executable":true,"value":"# Set up the optimal control problem\nocp = opt.OptimalControlProblem(\n    proc, timepts, traj_cost,\n    terminal_cost=term_cost,\n    trajectory_constraints=traj_constraints,\n    # terminal_constraints=term_constraints,\n)","identifier":"e9f31be6-code","enumerator":"6","html_id":"e9f31be6-code","key":"QCMwln1ipo"},{"type":"outputs","id":"OLsgRFAkr66fpa3A8sxHi","children":[],"identifier":"e9f31be6-outputs","html_id":"e9f31be6-outputs","key":"gFPuWTvDkr"}],"identifier":"e9f31be6","label":"e9f31be6","html_id":"e9f31be6","key":"q6Tjng057U"},{"type":"block","kind":"notebook-content","data":{"id":"ee9a39dd"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To make sure that the problem is properly defined, we first solve the problem for a specific initial condition.  We also compare the amount of time required to solve the problem from a “cold start” (no initial guess) versus a “warm start” (use the previous solution, shifted forward on point in time).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"POW7gckJXk"}],"key":"OTupDI9pnu"}],"identifier":"ee9a39dd","label":"ee9a39dd","html_id":"ee9a39dd","key":"QooQkYsJNJ"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":743,"status":"ok","timestamp":1761933568871,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"887295eb","outputId":"bc37bc51-eb1d-4013-8db1-5d2917d2b117"},"children":[{"type":"code","lang":"python","executable":true,"value":"X0 = np.array([1, 1])\n\nstart_time = time.process_time()\nres = ocp.compute_trajectory(X0, initial_guess=0, return_states=True)\nstop_time = time.process_time()\nprint(f'* Cold start: {stop_time-start_time:.3} sec')\n\n# Resolve using previous solution (shifted forward) as initial guess to compare timing\nstart_time = time.process_time()\nu = res.inputs\nu_shift = np.hstack([u[:, 1:], u[:, -1:]])\nocp.compute_trajectory(X0, initial_guess=u_shift, print_summary=False)\nstop_time = time.process_time()\nprint(f'* Warm start: {stop_time-start_time:.3} sec')","identifier":"887295eb-code","enumerator":"7","html_id":"id-887295eb-code","key":"ObqKmeAOIx"},{"type":"outputs","id":"Uyn1LKy_8Lvk_kTAdHkVb","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Summary statistics:\n* Cost function calls: 238\n* Constraint calls: 280\n* System simulations: 2\n* Final cost: 6.023383015581568\n* Cold start: 0.329 sec\n* Warm start: 0.449 sec\n"},"children":[],"identifier":"887295eb-outputs-0","html_id":"id-887295eb-outputs-0","key":"TmjdI04kHg"}],"identifier":"887295eb-outputs","html_id":"id-887295eb-outputs","key":"juEDdrQIKA"}],"identifier":"887295eb","label":"887295eb","html_id":"id-887295eb","key":"dcIHBipTXy"},{"type":"block","kind":"notebook-content","data":{"id":"115dec26"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this case the timing is not that different since the system is very simple.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VLmxiCQhym"}],"key":"rUfFmculFP"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Plotting the result, we see that the solution is properly computed.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"j5YSxAlbEA"}],"key":"g5jVORr1x7"}],"identifier":"115dec26","label":"115dec26","html_id":"id-115dec26","key":"Gl3p4Zp27r"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/","height":449},"executionInfo":{"elapsed":718,"status":"ok","timestamp":1761933569590,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"4b98e773","outputId":"6b386829-50c4-491a-b2a2-d67d19d56b71"},"children":[{"type":"code","lang":"python","executable":true,"value":"plt.plot(res.time, res.states[0], 'k-', label='$x_1$')\nplt.plot(res.time, res.inputs[0], 'b-', label='u')\nplt.xlabel('Time [s]')\nplt.ylabel('$x_1$, $u$')\nplt.legend();","identifier":"4b98e773-code","enumerator":"8","html_id":"id-4b98e773-code","key":"c6BkjvDfm8"},{"type":"outputs","id":"AAofnnoIV4q_-LoSQ___m","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cd05109b7d799d8b730130d1df04427f","path":"/cd05109b7d799d8b730130d1df04427f.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"4b98e773-outputs-0","html_id":"id-4b98e773-outputs-0","key":"jEqDs4y94b"}],"identifier":"4b98e773-outputs","html_id":"id-4b98e773-outputs","key":"rJm7JK1btH"}],"identifier":"4b98e773","label":"4b98e773","html_id":"id-4b98e773","key":"u4cGXgg5zd"},{"type":"block","kind":"notebook-content","data":{"id":"0e85981a"},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"MPC controller","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AHXIZro1mk"}],"identifier":"mpc-controller","label":"MPC controller","html_id":"mpc-controller","implicit":true,"key":"VVPHdi4ZgQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"After setting up the problem, now we can implement the MPC controller using a function that we can use with different versions of the problem.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"isRKCz4jWl"}],"key":"yafXadP2cb"}],"identifier":"0e85981a","label":"0e85981a","html_id":"id-0e85981a","key":"TQ1FOIxi23"},{"type":"block","kind":"notebook-code","data":{"executionInfo":{"elapsed":10,"status":"ok","timestamp":1761933569591,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"eb2e8126"},"children":[{"type":"code","lang":"python","executable":true,"value":"def run_mpc(proc, ocp, x0, tf, print_summary=False, verbose=False):\n    \"\"\"Run a MPC simulation.\"\"\"\n    x = x0\n    t_cur = 0.0 # current time\n\n    # Lists to store the full trajectory\n    time_hist, states_hist, inputs_hist = [np.array([t_cur])], [x0[:, np.newaxis]], []\n    first_iteration = True\n\n    # MPC loop\n    while t_cur < tf:\n        # Compute the optimal trajectory over the horizon\n        start_time = time.process_time()\n        res = ocp.compute_trajectory(x, print_summary=print_summary)\n        if verbose:\n            print(f\"t={t_cur:.2f}, compute time: {time.process_time() - start_time:.3f}s\")\n\n        # Determine the time step to apply (first interval of the OCP)\n        dt = res.time[1] - res.time[0]\n\n        # Handle the final, possibly partial, time step\n        t_apply = min(dt, tf - t_cur)\n        if t_apply < 1e-6: break # Avoid tiny final steps\n\n        # Simulate the system for one step using a constant u computed from the trajectory optimization\n        u_const = res.inputs[:, 0] # obtain the first control input\n        t_seg = np.linspace(0, t_apply, 20)\n        u_const_seg = np.tile(u_const[:, np.newaxis], (1, len(t_seg))) # constant input over the segment\n        soln = ctl.input_output_response(proc, t_seg, u_const_seg, x)\n\n        \"\"\"\n        # Simulate the system for one step using a first-order hold on the input\n        t_seg = np.linspace(0, t_apply, 20)\n        u_foh = res.inputs[:, 0] + np.outer(\n            (res.inputs[:, 1] - res.inputs[:, 0]) / dt, t_seg\n        )\n        soln = ctl.input_output_response(proc, t_seg, u_foh, x)\n        \"\"\"\n\n        # On the first iteration, store the initial input value\n        if first_iteration:\n            inputs_hist.append(soln.inputs[:, 0:1])\n            first_iteration = False\n\n        # Store the trajectory segment (omitting the first point to avoid overlap)\n        time_hist.append(t_cur + soln.time[1:])\n        states_hist.append(soln.states[:, 1:])\n        inputs_hist.append(soln.inputs[:, 1:])\n\n        # Update state and time for the next iteration\n        t_cur += t_apply # Advance current time\n        x = soln.states[:, -1] # Get the final state of the segment\n\n    return ctl.TimeResponseData(\n        np.hstack(time_hist),\n        np.hstack(states_hist), # Note: output is state for this system\n        np.hstack(states_hist),\n        np.hstack(inputs_hist)\n    )\n\n# Plotting function for MPC response\ndef plot_mpc(mpc_resp, ax=None):\n    \"\"\"Plot the results of a model predictive control simulation.\"\"\"\n    if ax is None:\n        fig, ax = plt.subplots(1, 1)\n\n    ax.plot(mpc_resp.time, mpc_resp.states[0], 'k-', label='$x_1$')\n    ax.plot(mpc_resp.time, mpc_resp.inputs[0], 'b-', label='$u$')\n\n    # Add reference line for input lower bound\n    ax.plot([0, mpc_resp.time[-1]], [-1, -1], 'k--', linewidth=0.7)\n\n    ax.set_ylim([-4, 3.5])\n    ax.set_xlabel(\"Time $t$ [sec]\")\n    ax.set_ylabel(\"State $x_1$, input $u$\")\n    ax.legend(loc='lower right')\n    ax.set_title(\"Model Predictive Control Response\")\n    plt.tight_layout()","identifier":"eb2e8126-code","enumerator":"9","html_id":"eb2e8126-code","key":"kSry8ez25V"},{"type":"outputs","id":"-_268nsvJBzo8fWE9D08p","children":[],"identifier":"eb2e8126-outputs","html_id":"eb2e8126-outputs","key":"KncLJqboHQ"}],"identifier":"eb2e8126","label":"eb2e8126","html_id":"eb2e8126","key":"rdpRcVmH6o"},{"type":"block","kind":"notebook-content","data":{"id":"be13e00a"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, we call the controller and plot the response. To get rid of the statistics of each optimization call, use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k00iBsG1Qk"},{"type":"inlineCode","value":"print_summary=False","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"otDcJdyxMG"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H8fB23Ga9J"}],"key":"aA4LzchnhY"}],"identifier":"be13e00a","label":"be13e00a","html_id":"be13e00a","key":"SGxAnWfQSV"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/","height":844},"executionInfo":{"elapsed":7442,"status":"ok","timestamp":1761933577034,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"305a1127","outputId":"b2c7204e-19f3-4684-8261-3ee016b72c92"},"children":[{"type":"code","lang":"python","executable":true,"value":"Tf = 10 # Total time for control\n# Run the simulation\nmpc_resp = run_mpc(proc, ocp, X0, Tf, verbose=True, print_summary=False)\nprint(f\"Final state xf = {mpc_resp.states[:, -1]}\")\n\n# Plot the results\nplot_mpc(mpc_resp)","identifier":"305a1127-code","enumerator":"10","html_id":"id-305a1127-code","key":"D95ZawSdp0"},{"type":"outputs","id":"B0xWLspgEIhFQrjy8fB3k","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"t=0.00, compute time: 0.353s\nt=0.50, compute time: 0.351s\nt=1.00, compute time: 0.326s\nt=1.50, compute time: 0.399s\nt=2.00, compute time: 0.240s\nt=2.50, compute time: 0.318s\nt=3.00, compute time: 0.393s\nt=3.50, compute time: 0.282s\nt=4.00, compute time: 0.289s\nt=4.50, compute time: 0.282s\nt=5.00, compute time: 0.279s\nt=5.50, compute time: 0.311s\nt=6.00, compute time: 0.187s\nt=6.50, compute time: 0.249s\nt=7.00, compute time: 0.251s\nt=7.50, compute time: 0.229s\nt=8.00, compute time: 0.204s\nt=8.50, compute time: 0.167s\nt=9.00, compute time: 0.128s\nt=9.50, compute time: 0.091s\nFinal state xf = [ 2.86173313e-03 -4.11115993e-05]\n"},"children":[],"identifier":"305a1127-outputs-0","html_id":"id-305a1127-outputs-0","key":"h5i4nMHdfQ"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"30a939e065c4e7a0c0ef558d4d5c4aed","path":"/30a939e065c4e7a0c0ef558d4d5c4aed.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"305a1127-outputs-1","html_id":"id-305a1127-outputs-1","key":"e4ggbRDcPv"}],"identifier":"305a1127-outputs","html_id":"id-305a1127-outputs","key":"sGNq25qArw"}],"identifier":"305a1127","label":"305a1127","html_id":"id-305a1127","key":"KIPAngEVx2"},{"type":"block","kind":"notebook-content","data":{"id":"895eaf6c"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Questions to think about:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pk3O9gIjMN"}],"key":"F4cvE4tyw4"}],"key":"OHvLCTZaR2"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We used four different time in the above simulation: ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JJe9r68A8d"},{"type":"inlineCode","value":"timepts","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"vmRj8JPPGd"},{"type":"text","value":", ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ulapdm8Z2V"},{"type":"inlineCode","value":"Th","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ovrno4N9Ln"},{"type":"text","value":", ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"AjzbO8vUFQ"},{"type":"inlineCode","value":"Tf","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MeAmab7yho"},{"type":"text","value":", and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"QQz1HKMvzG"},{"type":"inlineCode","value":"t_seg","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cnOQyHkG8m"},{"type":"text","value":". Explain what are they. Try to use different values for them and see how will it affect the simulation results.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fWK7LJFzV9"}],"key":"DdII2Fx3WD"}],"key":"lJQnpMjONo"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"In each step of the MPC loop, an optimal control problem is solved over the horizon ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dv0giEHo5y"},{"type":"inlineCode","value":"Th","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vZlSXLcHSP"},{"type":"text","value":". This provides an optimal input trajectory ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"P6CM7fiJzf"},{"type":"inlineCode","value":"u(t)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Y6U3iTvWKd"},{"type":"text","value":" for ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yJHVBOPNBA"},{"type":"inlineCode","value":"t","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZOYqsddj0J"},{"type":"text","value":" from 0 to ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AwdnYdiCTo"},{"type":"inlineCode","value":"Th","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"c96ciuQ2FX"},{"type":"text","value":". How much of this trajectory is actually applied to the plant before the optimization is performed again? What is the time step of the MPC controller?","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VoodDFqsBK"}],"key":"FxpIjI0Oqb"}],"key":"Y6BC74IGLM"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The terminal cost is defined by the matrix ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"T14g9zHctT"},{"type":"inlineCode","value":"P1","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"y7vRp4tC2b"},{"type":"text","value":". What is the purpose of a terminal cost? What might happen to the system’s final state if you set ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"a99XO9NZip"},{"type":"inlineCode","value":"P1","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Bxv775j8Qg"},{"type":"text","value":" to be a zero matrix?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"OdD2MWECP2"}],"key":"unz0bsKeM2"}],"key":"SZCv8i2qTQ"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Try to use the first-order hold on the input that is commented out in the above code. Explain what is different from the constant control input? Do you notice any difference on the state trajectory?","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YGVcvpT1DS"}],"key":"dnPSY5x0mW"}],"key":"OLUnYPFQEX"}],"key":"c4ofUt4H4s"}],"identifier":"895eaf6c","label":"895eaf6c","html_id":"id-895eaf6c","key":"WIcVFEO7dV"},{"type":"block","kind":"notebook-content","data":{"id":"6005bfb3"},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"MPC vs LQR vs LQR terminal cost","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hvcLj5XIhG"}],"identifier":"mpc-vs-lqr-vs-lqr-terminal-cost","label":"MPC vs LQR vs LQR terminal cost","html_id":"mpc-vs-lqr-vs-lqr-terminal-cost","implicit":true,"key":"LG4K5Ys8jK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the formulation above, we used a MPC controller with the terminal cost as ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vhsSU9B2DR"},{"type":"inlineMath","value":"P_1 = \\text{diag}(0.1, 0.1)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub><mo>=</mo><mtext>diag</mtext><mo stretchy=\"false\">(</mo><mn>0.1</mn><mo separator=\"true\">,</mo><mn>0.1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">P_1 = \\text{diag}(0.1, 0.1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">diag</span></span><span class=\"mopen\">(</span><span class=\"mord\">0.1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0.1</span><span class=\"mclose\">)</span></span></span></span>","key":"SKXfsmsJkO"},{"type":"text","value":". An alternative is to set the terminal cost to be the LQR terminal cost that goes along with the trajectory cost, which then provides a “cost to go” that matches the LQR “cost to go” (but keeping in mind that the LQR controller does not necessarily respect the constraints for the control inputs).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FP0YjeH5BN"}],"key":"A0xXg2KxTh"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The following code compares three different controllers:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CbaJdwb7kb"}],"key":"XtgARyfoUA"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"MPC with ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"OH9DIwHHzw"},{"type":"inlineCode","value":"P1","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"GqvNW2Y20T"},{"type":"text","value":" terminal cost (","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"EgsMdc3dTS"},{"type":"inlineCode","value":"MPC + P1","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"gHxMw8EW44"},{"type":"text","value":")","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"fwhjBxPEuk"}],"key":"wCarYt0a4k"},{"type":"text","value":": This is the original MPC controller we designed. It uses a simple quadratic terminal cost defined by ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"akSEOy8Y0L"},{"type":"inlineCode","value":"P1","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"FoZrROBoY0"},{"type":"text","value":". This controller solves an optimal control problem at each step to plan a trajectory over a finite horizon, explicitly considering input constraints.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Stp1Y24NtH"}],"key":"zpBmgAIF2t"}],"key":"nuMk9tKYrb"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Standard LQR controller (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"RpW1qL21JP"},{"type":"inlineCode","value":"LQR","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uPg5nTd1Ru"},{"type":"text","value":")","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xyK8bIVRQH"}],"key":"GFP24JzLOk"},{"type":"text","value":": This is a linear state-feedback controller with gain ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"LYLOsuapt6"},{"type":"inlineCode","value":"K","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Vhz29rOcx9"},{"type":"text","value":" derived for the linearized, unconstrained system. The control law is ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"tEWsZOnwkq"},{"type":"inlineCode","value":"u = -Kx","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Mf0NEZDxyo"},{"type":"text","value":". For the simulation, this control law is applied to the original nonlinear system, so the input is effectively saturated (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CAIexeluvU"},{"type":"inlineCode","value":"clip(-Kx)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"h1YBFp8BZT"},{"type":"text","value":"). This controller is not predictive and does not explicitly account for constraints in its design, though it is subject to them in simulation.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Zqyc78c2GU"}],"key":"nKktVWRXxq"}],"key":"Uyxg0aD06Q"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"MPC with LQR terminal cost (","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"apaBBktqDx"},{"type":"inlineCode","value":"MPC + P_lqr","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"gYhEdC8MFb"},{"type":"text","value":")","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"WFgKGxOjca"}],"key":"OpuKkkMivR"},{"type":"text","value":": This MPC controller is identical to the first, but it uses the solution ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ktDippaPay"},{"type":"inlineCode","value":"P_lqr","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"fHOb9cledt"},{"type":"text","value":" of the algebraic Riccati equation from the corresponding LQR problem as its terminal cost. This provides a more accurate estimate of the “cost-to-go” beyond the prediction horizon, often leading to improved performance and stability.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"lSxWBOtzhb"}],"key":"tJcuhA9rzO"}],"key":"EhXbUbS3Hb"}],"key":"vwTixR9Rm4"}],"identifier":"6005bfb3","label":"6005bfb3","html_id":"id-6005bfb3","key":"ScYL1k5ED7"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/","height":517},"executionInfo":{"elapsed":33668,"status":"ok","timestamp":1761933610721,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"ea2de1f3","outputId":"66fc9f50-4f7c-451d-861c-91ad809f562a"},"children":[{"type":"code","lang":"python","executable":true,"value":"# Get the LQR solution\nK, P_lqr, E = ctl.lqr(proc.linearize(0, 0), Qx, Qu)\nprint(f\"P_lqr = \\n{P_lqr}\")\n\n# Create an LQR controller (and run it)\nlqr_ctrl, lqr_clsys = ctl.create_statefbk_iosystem(proc, K)\nlqr_resp = ctl.input_output_response(lqr_clsys, mpc_resp.time, 0, X0)\n\n# Create a new optimal control problem using the LQR terminal cost\n# (need use more refined time grid as well, to approximate LQR rate)\nlqr_timepts = np.linspace(0, Th, 25, endpoint=True)\nlqr_term_cost=opt.quadratic_cost(proc, P_lqr, None) # here we used P_lqr instead of P1\nocp_lqr = opt.OptimalControlProblem(\n    proc, lqr_timepts, traj_cost, terminal_cost=lqr_term_cost,\n    trajectory_constraints=traj_constraints,\n)\n\n# Create the response for the new controller\nmpc_lqr_resp = run_mpc(\n    proc, ocp_lqr, X0, 10, print_summary=False)\n\n# Plot the different responses to compare them\nfig, ax = plt.subplots(2, 1)\nax[0].plot(mpc_resp.time, mpc_resp.states[0], label='MPC + P_1')\nax[0].plot(lqr_resp.time, lqr_resp.outputs[0], ':', label='LQR')\nax[0].plot(mpc_lqr_resp.time, mpc_lqr_resp.states[0], '--', label='MPC + P_lqr')\nax[0].set_ylabel('Position $x_1$')\nax[0].legend()\n\nax[1].plot(mpc_resp.time, mpc_resp.inputs[0], label='MPC + P_1')\nax[1].plot(lqr_resp.time, lqr_resp.outputs[2], ':', label='LQR')\nax[1].plot(mpc_lqr_resp.time, mpc_lqr_resp.inputs[0], '--', label='MPC + P_lqr')\nax[1].set_ylabel('Input $u$')\nax[1].set_xlabel('Time [s]')\nax[1].legend()","identifier":"ea2de1f3-code","enumerator":"11","html_id":"ea2de1f3-code","key":"wqibVxcYX3"},{"type":"outputs","id":"DqJnB9aoKRb3VW_A_JqWI","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"P_lqr = \n[[1.41421356 1.        ]\n [1.         1.41421356]]\n"},"children":[],"identifier":"ea2de1f3-outputs-0","html_id":"ea2de1f3-outputs-0","key":"TekOF5X8X2"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"77b74984bc42d317dc6d2c871d0d3789","path":"/77b74984bc42d317dc6d2c871d0d3789.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"ea2de1f3-outputs-2","html_id":"ea2de1f3-outputs-2","key":"FUOh3n8fHC"}],"identifier":"ea2de1f3-outputs","html_id":"ea2de1f3-outputs","key":"rUsvKRPLYA"}],"identifier":"ea2de1f3","label":"ea2de1f3","html_id":"ea2de1f3","key":"svIlSXOnXJ"},{"type":"block","kind":"notebook-content","data":{"id":"9497530b"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Task 2: Discrete time MPC","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qos5ELijf9"}],"identifier":"task-2-discrete-time-mpc","label":"Task 2: Discrete time MPC","html_id":"task-2-discrete-time-mpc","implicit":true,"key":"jnnMqDcVf8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Continous time MPC can generate smooth, higher-fidelity behavior at higher compute cost and with interpolation subtleties.  Many MPC control problems are solved based on a discrete time model, which is simpler, faster, and closer to how real controllers run, provided your time step is chosen well.  We show here how to implement this for the “double integrator” system, which in discrete time has the form","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Fk0Wc7Tdgm"}],"key":"WQGWh7gIHG"},{"type":"math","value":"x[k+1] = \\begin{bmatrix} 1 & dt \\\\ 0 & 1 \\end{bmatrix} x[k] + \\begin{bmatrix} 0 \\\\ dt \\end{bmatrix} \\text{clip}(u[k])","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"tight":true,"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>x</mi><mo stretchy=\"false\">[</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mo>=</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>d</mi><mi>t</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mi>x</mi><mo stretchy=\"false\">[</mo><mi>k</mi><mo stretchy=\"false\">]</mo><mo>+</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>d</mi><mi>t</mi></mrow></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mtext>clip</mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo stretchy=\"false\">[</mo><mi>k</mi><mo stretchy=\"false\">]</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x[k+1] = \\begin{bmatrix} 1 &amp; dt \\\\ 0 &amp; 1 \\end{bmatrix} x[k] + \\begin{bmatrix} 0 \\\\ dt \\end{bmatrix} \\text{clip}(u[k])</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">clip</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">])</span></span></span></span></span>","enumerator":"3","key":"BU1VqE3u8X"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HvjAb7VvOz"},{"type":"inlineMath","value":"dt","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">dt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"hyYdkMr0qU"},{"type":"text","value":" is the time step.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kcR2ZEy9UU"}],"key":"G2qkBVoHe4"}],"identifier":"9497530b","label":"9497530b","html_id":"id-9497530b","key":"E6eXMQhnUv"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/","height":491},"executionInfo":{"elapsed":546,"status":"ok","timestamp":1761933611269,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"ae7cefa5","outputId":"e7126ebf-6504-40c7-a1ca-f314c4233e08"},"children":[{"type":"code","lang":"python","executable":true,"value":"# System definition\n\ndef doubleint_update(t, x, u, params):\n    # Get the parameters\n    lb = params.get('lb', -1)\n    ub = params.get('ub', 1)\n    assert lb < ub\n\n    # Get the sampling time\n    dt = params.get('dt', 1)\n\n    # bound the input\n    u_clip = np.clip(u, lb, ub)\n\n    return np.array([x[0] + dt * x[1], x[1] + dt * u_clip[0]])\n\nproc = ctl.nlsys(\n    doubleint_update, None, name=\"double integrator\",\n    inputs = ['u'], outputs=['x[0]', 'x[1]'], states=2,\n    params={'dt': 1}, dt=1)\n\n#\n# Linear quadratic regulator\n#\n\n# Define the cost functions to use\nQx = np.diag([1, 0])            # matrix for state cost\nQu = np.diag([1])               # matrix for input cost\nP1 = np.diag([0.1, 0.1])        # matrix for terminal cost\n\n# Get the LQR solution\nK, P, E = ctl.dlqr(proc.linearize(0, 0), Qx, Qu)\n\n# Test out the LQR controller, with no constraints\nlinsys = proc.linearize(0, 0)\nclsys_lin = ctl.ss(linsys.A - linsys.B @ K, linsys.B, linsys.C, 0, dt=proc.dt)\n\nX0 = np.array([2, 1])           # initial conditions\nTf = 10                         # simulation time\nres = ctl.initial_response(clsys_lin, Tf, X0=X0)\n\n# Plot the results\nplt.figure(1); plt.clf(); ax = plt.axes()\nax.plot(res.time, res.states[0], 'k-', label='$x_1$')\nax.plot(res.time, (-K @ res.states)[0], 'b-', label='$u$')\n\n# Test out the LQR controller with constraints\nclsys_lqr = ctl.feedback(proc, -K, 1)\ntvec = np.arange(0, Tf, proc.dt)\nres_lqr_const = ctl.input_output_response(clsys_lqr, tvec, 0, X0)\n\n# Plot the results\nax.plot(res_lqr_const.time, res_lqr_const.states[0], 'k--', label='constrained')\n#ax.plot(res_lqr_const.time, (-K @ res_lqr_const.states)[0], 'b--')\nax.plot([0, 7], [-1, -1], 'k--', linewidth=0.75)\n\n# Compute and plot the clipped (actual) control input\nu_raw_const = (-K @ res_lqr_const.states)       # controller output before clipping\nu_clip_const = np.clip(u_raw_const, -1, 1)      # actual applied control\nax.plot(res_lqr_const.time, u_clip_const[0], 'b--')\n\n\n# Adjust the limits for consistency\nax.set_ylim([-4, 3.5])\n\n# Label the results\nax.set_xlabel(\"Time $t$ [sec]\")\nax.set_ylabel(\"State $x_1$, input $u$\")\nax.legend(loc='lower right', labelspacing=0)\nplt.title(\"Linearized LQR response from x0\")","identifier":"ae7cefa5-code","enumerator":"12","html_id":"ae7cefa5-code","key":"Wb1AaanVTu"},{"type":"outputs","id":"RLbfminJnCu4wLaQaVldi","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b77aba0c610f96c3d0186fca6cbbb62e","path":"/b77aba0c610f96c3d0186fca6cbbb62e.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"ae7cefa5-outputs-1","html_id":"ae7cefa5-outputs-1","key":"boMsR5iAsN"}],"identifier":"ae7cefa5-outputs","html_id":"ae7cefa5-outputs","key":"fqXflvzbqm"}],"identifier":"ae7cefa5","label":"ae7cefa5","html_id":"ae7cefa5","key":"jVZ3mHO8zn"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/","height":606},"executionInfo":{"elapsed":1490,"status":"ok","timestamp":1761933612847,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"13cfc5d8","outputId":"b969bf10-2ed7-4a21-b018-b572e32f6800"},"children":[{"type":"code","lang":"python","executable":true,"value":"#\n# MPC controller\n#\n\n# Create the constraints\ntraj_constraints = opt.input_range_constraint(proc, -1, 1)\nterm_constraints = opt.state_range_constraint(proc, [0, 0], [0, 0])\n\n# Define the optimal control problem we want to solve\nT = 5\ntimepts = np.arange(0, T * proc.dt, proc.dt)\n\n# Set up four optimal control problems\n# ocp1: the original with P1\nocp_orig = opt.OptimalControlProblem(\n    proc, timepts,\n    opt.quadratic_cost(proc, Qx, Qu),\n    trajectory_constraints=traj_constraints,\n    terminal_cost=opt.quadratic_cost(proc, P1, None),\n)\n\n# ocp2: the LQR with P\nocp_lqr = opt.OptimalControlProblem(\n    proc, timepts,\n    opt.quadratic_cost(proc, Qx, Qu),\n    trajectory_constraints=traj_constraints,\n    terminal_cost=opt.quadratic_cost(proc, P, None),\n)\n\n#ocp3: scaled down P\nocp_low = opt.OptimalControlProblem(\n    proc, timepts,\n    opt.quadratic_cost(proc, Qx, Qu),\n    trajectory_constraints=traj_constraints,\n    terminal_cost=opt.quadratic_cost(proc, P/10, None),\n)\n\n#ocp4: scaled up P\nocp_high = opt.OptimalControlProblem(\n    proc, timepts,\n    opt.quadratic_cost(proc, Qx, Qu),\n    trajectory_constraints=traj_constraints,\n    terminal_cost=opt.quadratic_cost(proc, P*10, None),\n)\nweight_list = [P1, P, P/10, P*10]\nocp_list = [ocp_orig, ocp_lqr, ocp_low, ocp_high]\n\n# Do a test run to figure out how long computation takes\nstart_time = time.process_time()\nocp_lqr.compute_trajectory(X0)\nstop_time = time.process_time()\nprint(\"* Process time: %0.2g s\\n\" % (stop_time - start_time))\n\n# Create a figure to use for plotting\nfig, [[ax_orig, ax_lqr], [ax_low, ax_high]] = plt.subplots(2, 2)\nax_list = [ax_orig, ax_lqr, ax_low, ax_high]\nax_name = ['orig', 'lqr', 'low', 'high']\n\n# Generate the individual traces for the MPC control\nfor ocp, ax, name, Pf in zip(ocp_list, ax_list, ax_name, weight_list):\n    x, t = X0, 0\n    for i in np.arange(0, Tf, proc.dt):\n        # Calculate the optimal trajectory\n        res = ocp.compute_trajectory(x, print_summary=False)\n        soln = ctl.input_output_response(proc, res.time, res.inputs, x)\n\n        # Plot the results for this time instant\n        ax.plot(res.time[:2] + t, res.inputs[0, :2], 'b-', linewidth=1)\n        ax.plot(res.time[:2] + t, soln.outputs[0, :2], 'k-', linewidth=1)\n\n        # Plot the results projected forward\n        ax.plot(res.time[1:] + t, res.inputs[0, 1:], 'b--', linewidth=0.75)\n        ax.plot(res.time[1:] + t, soln.outputs[0, 1:], 'k--', linewidth=0.75)\n\n        # Update the state to use for the next time point\n        x = soln.states[:, 1]\n        t += proc.dt\n\n    # Adjust the limits for consistency\n    ax.set_ylim([-1.5, 3.5])\n\n    # Label the results\n    ax.set_xlabel(\"Time $t$ [sec]\")\n    ax.set_ylabel(\"State $x_1$, input $u$\")\n    ax.set_title(f\"MPC response for {name}\")\n    plt.tight_layout()","identifier":"13cfc5d8-code","enumerator":"13","html_id":"id-13cfc5d8-code","key":"Fl3A747qoS"},{"type":"outputs","id":"wu9CekTDK5y-iPpWlXoyB","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Summary statistics:\n* Cost function calls: 38\n* Constraint calls: 51\n* System simulations: 82\n* Final cost: 29.248892708529276\n* Process time: 0.042 s\n\n"},"children":[],"identifier":"13cfc5d8-outputs-0","html_id":"id-13cfc5d8-outputs-0","key":"uQlLEIrGRO"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"be532c13325c47258913c19ccd1c1324","path":"/be532c13325c47258913c19ccd1c1324.png"},"text/plain":{"content":"<Figure size 640x480 with 4 Axes>","content_type":"text/plain"}}},"children":[],"identifier":"13cfc5d8-outputs-1","html_id":"id-13cfc5d8-outputs-1","key":"UT3sMQwYfH"}],"identifier":"13cfc5d8-outputs","html_id":"id-13cfc5d8-outputs","key":"oIB7Fh0QG1"}],"identifier":"13cfc5d8","label":"13cfc5d8","html_id":"id-13cfc5d8","key":"jKi9I8Hmpx"},{"type":"block","kind":"notebook-content","data":{"id":"015dc953"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can also implement a MPC controller for a discrete time system using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JUyspSrDTK"},{"type":"inlineCode","value":"opt.create_mpc_iosystem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YMuGv8rbQ8"},{"type":"text","value":".  This creates a controller that accepts the current state as the input and generates the control to apply from that state.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"URTdFJhxCO"}],"key":"KeREkmbQIa"}],"identifier":"015dc953","label":"015dc953","html_id":"id-015dc953","key":"FkC8dwEdG1"},{"type":"block","kind":"notebook-code","data":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2,"status":"ok","timestamp":1761933612850,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"4f8bb594","outputId":"ab957432-7f9a-47f9-eef4-b5ffd3ef11f5"},"children":[{"type":"code","lang":"python","executable":true,"value":"# Construct using create_mpc_iosystem\nclsys = opt.create_mpc_iosystem(\n    proc, timepts, opt.quadratic_cost(proc, Qx, Qu), traj_constraints,\n    terminal_cost=opt.quadratic_cost(proc, P1, None),\n)\nprint(clsys)","identifier":"4f8bb594-code","enumerator":"14","html_id":"id-4f8bb594-code","key":"BAxOF7RvoG"},{"type":"outputs","id":"SdvUvXP5huTodKYBsLO-9","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"<NonlinearIOSystem>: sys[7]\nInputs (2): ['x[0]', 'x[1]']\nOutputs (1): ['u']\nStates (5): ['x[0]', 'x[1]', 'x[2]', 'x[3]', 'x[4]']\ndt = 1\n\nUpdate: <function OptimalControlProblem.create_mpc_iosystem.<locals>._update at 0x7b6b589465c0>\nOutput: <function OptimalControlProblem.create_mpc_iosystem.<locals>._output at 0x7b6b589468e0>\n"},"children":[],"identifier":"4f8bb594-outputs-0","html_id":"id-4f8bb594-outputs-0","key":"TUFpBTFSiu"}],"identifier":"4f8bb594-outputs","html_id":"id-4f8bb594-outputs","key":"Z7pQLmpodf"}],"identifier":"4f8bb594","label":"4f8bb594","html_id":"id-4f8bb594","key":"NEfpdJWT4X"},{"type":"block","kind":"notebook-content","data":{"id":"f1b08fb4"},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"(This function needs some work to be more user-friendly, e.g. renaming of the inputs and outputs.)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dnUW9ehEyf"}],"key":"PLT4B49hmx"}],"identifier":"f1b08fb4","label":"f1b08fb4","html_id":"f1b08fb4","key":"SAvV6uOI0W"},{"type":"block","kind":"notebook-content","data":{"id":"8c894093"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"HW Problem","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"F2j7xinr4m"}],"identifier":"hw-problem","label":"HW Problem","html_id":"hw-problem","implicit":true,"key":"vj60I0naHx"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Problem: MPC for kinematic car","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"H69b701ugM"}],"identifier":"problem-mpc-for-kinematic-car","label":"Problem: MPC for kinematic car","html_id":"problem-mpc-for-kinematic-car","implicit":true,"key":"r01VpebFyN"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We take the state of the system as ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aKNcGp8SSr"},{"type":"inlineMath","value":"(x, y, \\theta)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo separator=\"true\">,</mo><mi>θ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x, y, \\theta)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span></span></span></span>","key":"ARQX88bXei"},{"type":"text","value":" where ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"u2RhXmEpCZ"},{"type":"inlineMath","value":"(x, y)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x, y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span>","key":"SYNnzWA41H"},{"type":"text","value":" is the position of the vehicle in the plane and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YUZpqL0s4W"},{"type":"inlineMath","value":"\\theta","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span>","key":"c8WsqCvgCW"},{"type":"text","value":" is the angle of the vehicle with respect to horizontal.  The vehicle input is given by ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lCkubJzEVy"},{"type":"inlineMath","value":"(v, \\delta)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>v</mi><mo separator=\"true\">,</mo><mi>δ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(v, \\delta)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span><span class=\"mclose\">)</span></span></span></span>","key":"d1o3j7uKN2"},{"type":"text","value":" where ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nwhPY4JFV8"},{"type":"inlineMath","value":"v","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span>","key":"GkYl9IlKmg"},{"type":"text","value":" is the forward velocity of the vehicle and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"sxW6EqvdaD"},{"type":"inlineMath","value":"\\delta","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>δ</mi></mrow><annotation encoding=\"application/x-tex\">\\delta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span></span></span></span>","key":"N0bMEjK6SQ"},{"type":"text","value":" is the angle of the steering wheel.  The model includes saturation of the vehicle steering angle.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MKtJW5ZRmI"}],"key":"NS1gjMAnT5"},{"type":"math","value":"\\begin{aligned}\n  \\dot x &= \\cos\\theta\\, v \\\\\n  \\dot y &= \\sin\\theta\\, v \\\\\n  \\dot\\theta &= \\frac{v}{l} \\tan \\delta\n\\end{aligned}","position":{"start":{"line":7,"column":1},"end":{"line":11,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.25em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mover accent=\"true\"><mi>x</mi><mo>˙</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mtext> </mtext><mi>v</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mover accent=\"true\"><mi>y</mi><mo>˙</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mtext> </mtext><mi>v</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mover accent=\"true\"><mi>θ</mi><mo>˙</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mfrac><mi>v</mi><mi>l</mi></mfrac><mi>tan</mi><mo>⁡</mo><mi>δ</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\n  \\dot x &amp;= \\cos\\theta\\, v \\\\\n  \\dot y &amp;= \\sin\\theta\\, v \\\\\n  \\dot\\theta &amp;= \\frac{v}{l} \\tan \\delta\n\\end{aligned}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:5.0936em;vertical-align:-2.2968em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7968em;\"><span style=\"top:-5.0643em;\"><span class=\"pstrut\" style=\"height:3.1076em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\">x</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1111em;\"><span class=\"mord\">˙</span></span></span></span></span></span></span></span></span><span style=\"top:-3.5643em;\"><span class=\"pstrut\" style=\"height:3.1076em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.0833em;\"><span class=\"mord\">˙</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span><span style=\"top:-1.7968em;\"><span class=\"pstrut\" style=\"height:3.1076em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9313em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span><span style=\"top:-3.2634em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.0556em;\"><span class=\"mord\">˙</span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.2968em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7968em;\"><span style=\"top:-5.0643em;\"><span class=\"pstrut\" style=\"height:3.1076em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span><span style=\"top:-3.5643em;\"><span class=\"pstrut\" style=\"height:3.1076em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span><span style=\"top:-1.7968em;\"><span class=\"pstrut\" style=\"height:3.1076em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1076em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">tan</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.2968em;\"><span></span></span></span></span></span></span></span></span></span></span></span>","enumerator":"4","key":"EjKoZxDVa0"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Scenario:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"TZQ6w0aR7P"}],"key":"Mb2KWRXjaT"},{"type":"text","value":" A vehicle needs to perform a lane change maneuver while traveling forward. The vehicle starts in the left lane (at ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"j9CyHEjaxu"},{"type":"inlineMath","value":"y = -2","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">y = -2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">2</span></span></span></span>","key":"brMaSbBRUN"},{"type":"text","value":" m) and needs to move to the right lane (at ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Sl1lEL39IT"},{"type":"inlineMath","value":"y = +2","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi><mo>=</mo><mo>+</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">y = +2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">2</span></span></span></span>","key":"kkOWVMx7hC"},{"type":"text","value":" m) over a distance of 100 m, completing the maneuver in 10 seconds. The vehicle should maintain a constant forward velocity of 10 m/s throughout the maneuver.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"hsYNRCtjis"}],"key":"exwFpcf30b"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Initial and Final Conditions:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ehbqcT4yFn"}],"key":"be1KKy1Na7"}],"key":"F7vVsB237g"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":16,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Initial state: ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"WiWX2zP4TJ"},{"type":"inlineMath","value":"x_0 = [0, -2, 0]","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>=</mo><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mo>−</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>0</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">x_0 = [0, -2, 0]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">−</span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">]</span></span></span></span>","key":"TvXDebTVL0"},{"type":"text","value":" (position: origin, left lane, heading: 0°)","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"WoXzVzGQEX"}],"key":"RamF707nE9"}],"key":"BFMR08OwbW"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Initial input: ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"srqicfX8jP"},{"type":"inlineMath","value":"u_0 = [10, 0]","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>u</mi><mn>0</mn></msub><mo>=</mo><mo stretchy=\"false\">[</mo><mn>10</mn><mo separator=\"true\">,</mo><mn>0</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">u_0 = [10, 0]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">10</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">]</span></span></span></span>","key":"SRcDafZ8U8"},{"type":"text","value":" (velocity: 10 m/s, steering: 0 rad)","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"V3Q0bbspWz"}],"key":"i4Di57gGlq"}],"key":"ofM1EaQQUM"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Final state: ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"srj4AJEdw0"},{"type":"inlineMath","value":"x_f = [100, 2, 0]","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>f</mi></msub><mo>=</mo><mo stretchy=\"false\">[</mo><mn>100</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>0</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">x_f = [100, 2, 0]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">100</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">]</span></span></span></span>","key":"VFuLN97Dox"},{"type":"text","value":" (position: 100 m forward, right lane, heading: 0°)","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"la3oFrxIzw"}],"key":"JFzpuPsi5Y"}],"key":"QFTKuAQ1HR"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Final input: ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"K9RVpft6hO"},{"type":"inlineMath","value":"u_f = [10, 0]","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>u</mi><mi>f</mi></msub><mo>=</mo><mo stretchy=\"false\">[</mo><mn>10</mn><mo separator=\"true\">,</mo><mn>0</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">u_f = [10, 0]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">10</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">0</span><span class=\"mclose\">]</span></span></span></span>","key":"gMQAnzFDP5"},{"type":"text","value":" (velocity: 10 m/s, steering: 0 rad)","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"YXfiT2c6jQ"}],"key":"eTOKTxFBqk"}],"key":"JMiL0Msl2h"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Total maneuver time: ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Va2fbul4z5"},{"type":"inlineMath","value":"T_f = 10","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mi>f</mi></msub><mo>=</mo><mn>10</mn></mrow><annotation encoding=\"application/x-tex\">T_f = 10</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9694em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">10</span></span></span></span>","key":"dTZBOveVxJ"},{"type":"text","value":" s","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Iso2j791Lv"}],"key":"fVhWrcxA5j"}],"key":"xU87UGyPJj"}],"key":"tPDSZlZX0h"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Before you perform the tasks below, first generate an open‑loop optimal trajectory ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"OZLCj80tuO"},{"type":"inlineMath","value":"x_d(t),\\, u_d(t)","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mtext> </mtext><msub><mi>u</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x_d(t),\\, u_d(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"aWdohsHxR7"},{"type":"text","value":" for the scenario above using Lab 7 (Approach 3: input cost + terminal constraints). We will use this planned trajectory as the reference to be tracked by the MPC controller in Task 1.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"jnMVl2Eeq6"}],"key":"Cf10n0bbL6"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"strong","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Tasks:","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"WdZs10whkb"}],"key":"UtMg5tOxJI"}],"key":"RYF40POhan"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Following the implementation structure used for the double integrator system in Tasks 1 and 2, implement MPC controllers for the kinematic car:","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"HCt6vLRbto"}],"key":"wYTDD5RbtM"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":28,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Continuous-time MPC (Task 1 approach) — TRACK the given reference ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"yNwp4iuiK3"},{"type":"inlineMath","value":"x_d(t), u_d(t)","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><msub><mi>u</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x_d(t), u_d(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"ysfkG1yyb5"},{"type":"text","value":" from Lab 7:","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"u6r8FWcH4n"}],"key":"huej6pKDPf"}],"key":"D1WIdzyMoT"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":29,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Build time-aligned interpolants for the reference over the prediction horizon:","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"e0bkeBfoSI"}],"key":"ft4DGwpieB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create ","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"HZP0ZKn7dg"},{"type":"inlineMath","value":"x_d(t)","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x_d(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"RGifCLWu1G"},{"type":"text","value":" and ","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"EEDGOtXgCl"},{"type":"inlineMath","value":"u_d(t)","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>u</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">u_d(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"r4NT5SG5n6"},{"type":"text","value":" from your sampled Lab 7 trajectory using linear interpolation (first‑order hold). In Python, you can use ","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"FTCm7J34Jy"},{"type":"inlineCode","value":"scipy.interpolate.interp1d(..., kind='linear', axis=1)","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"Ubkl0cwxjr"},{"type":"text","value":" for states and inputs.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"qmbHjb8ulk"}],"key":"BWAs24BDOV"}],"key":"Bge8YdeFU9"}],"key":"W3oX8wo9zl"}],"key":"fo3cGUw66G"},{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Define a tracking cost that penalizes deviation from the reference and control effort:","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"frhVLal8af"}],"key":"HkOtdYkjMk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":32,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Trajectory (integral) cost: ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"lWMMEJe6mG"},{"type":"inlineMath","value":"\\int_0^{T_h} (x(t)-x_d(t))^T Q_x (x(t)-x_d(t)) + (u(t)-u_d(t))^T Q_u (u(t)-u_d(t)) \\, dt","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∫</mo><mn>0</mn><msub><mi>T</mi><mi>h</mi></msub></msubsup><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>x</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><msup><mo stretchy=\"false\">)</mo><mi>T</mi></msup><msub><mi>Q</mi><mi>x</mi></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>x</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>+</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>u</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><msup><mo stretchy=\"false\">)</mo><mi>T</mi></msup><msub><mi>Q</mi><mi>u</mi></msub><mo stretchy=\"false\">(</mo><mi>u</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>u</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mtext> </mtext><mi>d</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">\\int_0^{T_h} (x(t)-x_d(t))^T Q_x (x(t)-x_d(t)) + (u(t)-u_d(t))^T Q_u (u(t)-u_d(t)) \\, dt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.3921em;vertical-align:-0.3558em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0362em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:-0.1389em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">h</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3558em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0913em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">))</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0913em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">))</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"FIN9x7aUwN"},{"type":"text","value":".","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"ZMo2N6DSnt"}],"key":"g34Im8KpmZ"}],"key":"yM1ZvWhLO7"},{"type":"listItem","spread":true,"position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Terminal cost: ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"nJ8v6IRUYl"},{"type":"inlineMath","value":"(x(T_h)-x_d(T_h))^T P (x(T_h)-x_d(T_h))","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">(</mo><msub><mi>T</mi><mi>h</mi></msub><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>x</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><msub><mi>T</mi><mi>h</mi></msub><mo stretchy=\"false\">)</mo><msup><mo stretchy=\"false\">)</mo><mi>T</mi></msup><mi>P</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">(</mo><msub><mi>T</mi><mi>h</mi></msub><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>x</mi><mi>d</mi></msub><mo stretchy=\"false\">(</mo><msub><mi>T</mi><mi>h</mi></msub><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x(T_h)-x_d(T_h))^T P (x(T_h)-x_d(T_h))</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">h</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0913em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">h</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">h</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">h</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">))</span></span></span></span>","key":"eFOu7v39nJ"},{"type":"text","value":".","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"CdOhp9rAr1"}],"key":"slsaMesF8n"}],"key":"GqGYZADXFp"},{"type":"listItem","spread":true,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You may need to use something like ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"lqN1BlE0mX"},{"type":"inlineCode","value":"traj_cost = opt.quadratic_cost(proc, Qx, Qu, x0=x_d(t), u0=u_d(t))","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"qJ4mq0sRQM"}],"key":"qX0nQLzv8Q"}],"key":"zEZfjON42S"}],"key":"x3mIiOkIPU"}],"key":"JQVYytZwP1"},{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Set input constraints consistent with the model and scenario:","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"UZOPwKoAxF"}],"key":"vq4AqPzKzk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Steering limit ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"UsjBmceAzc"},{"type":"inlineMath","value":"|\\delta| \\le \\delta_{\\max}","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>δ</mi><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><msub><mi>δ</mi><mi>max</mi><mo>⁡</mo></msub></mrow><annotation encoding=\"application/x-tex\">|\\delta| \\le \\delta_{\\max}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0379em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mop mtight\"><span class=\"mtight\">m</span><span class=\"mtight\">a</span><span class=\"mtight\">x</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"FnlGTOHgPT"},{"type":"text","value":" (e.g., 0.5 rad). Optionally bound velocity around 10 m/s if desired.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"FvwSSV12i3"}],"key":"UpUNrt82Ob"}],"key":"pw3y2Ot4fT"}],"key":"ZksOSVdRBE"}],"key":"rsEmqXNgnZ"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Choose a prediction horizon ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"TDnPJy3VET"},{"type":"inlineMath","value":"T_h=5s","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mi>h</mi></msub><mo>=</mo><mn>5</mn><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">T_h=5s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">h</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">5</span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"arQIkcW7BF"},{"type":"text","value":" and a time grid ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"oDXew9vFpT"},{"type":"inlineCode","value":"timepts","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"Ya2MhXUE2Z"},{"type":"text","value":" for the OCP (e.g., with 11 grid points).","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"USk2TTfDWE"}],"key":"e6Pi3tYtkm"}],"key":"KtXruvTvsp"},{"type":"listItem","spread":true,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create an ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"ZE6quvJEot"},{"type":"inlineCode","value":"OptimalControlProblem","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"ezrOGIAxR8"},{"type":"text","value":" using the tracking cost and constraints.","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"yBbXWXGxEh"}],"key":"KFBR8oBBjA"}],"key":"in4BTN6n3q"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Implement an MPC simulation loop (similar to ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"Jw1Rri5TMp"},{"type":"inlineCode","value":"run_mpc()","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"uqE5gTFbHf"},{"type":"text","value":" from Task 1 for the double integrator).","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"AH3TYsukaq"}],"key":"yQjOV8KMJN"}],"key":"msdEOefyi1"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Plot and report:","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"v3LXnm5ZTS"}],"key":"dEXhuC2UeU"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":41,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"XY path: plot ","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"xPRCcfyUfM"},{"type":"inlineMath","value":"(x(t), y(t))","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x(t), y(t))</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">))</span></span></span></span>","key":"Fop1WubHDg"},{"type":"text","value":" for the closed loop and overlay the desired path from Lab7.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"uYVVgD9Bea"}],"key":"sWQts5hRcX"}],"key":"qGnLDIT3mf"},{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Time histories: plot ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"ctbpsiQ709"},{"type":"inlineMath","value":"x(t), y(t), \\theta(t)","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>θ</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x(t), y(t), \\theta(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"d4IFRQ4c9M"},{"type":"text","value":" and inputs ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"Fl1OTzFGOG"},{"type":"inlineMath","value":"v(t), \\delta(t)","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>δ</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">v(t), \\delta(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"niGMvQqZas"},{"type":"text","value":" versus their references.","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"rr8fbYoHVB"}],"key":"G9zzlr8ISq"}],"key":"v3p3vAJ6gr"}],"key":"j3xP2gXux7"}],"key":"uRKgHPlqrc"}],"key":"QnJ8G7CDbd"}],"key":"mHNHbi1FwE"},{"type":"listItem","spread":true,"position":{"start":{"line":44,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"strong","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Discrete-time MPC (Task 2 approach):","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"iRApMUIcaM"}],"key":"JRi5S917Zm"}],"key":"JKxlSPiHEk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":45,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Discretize the kinematic car model with an appropriate sampling time (e.g., ","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"fUK9aLQ0jF"},{"type":"inlineMath","value":"dt = 0.1","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>t</mi><mo>=</mo><mn>0.1</mn></mrow><annotation encoding=\"application/x-tex\">dt = 0.1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0.1</span></span></span></span>","key":"OxvenerOdM"},{"type":"text","value":" s)","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"XpYrV63AWG"}],"key":"NONk26r54f"}],"key":"Xpy1npYwNn"},{"type":"listItem","spread":true,"position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Define discrete-time cost functions and constraints","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"UoWbqRjYkG"}],"key":"zGU05AFwVp"}],"key":"VkUTLaIwDQ"},{"type":"listItem","spread":true,"position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Set up the discrete-time optimal control problem","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"bF3mOs9RBu"}],"key":"s4itD80zQ0"}],"key":"JjPchueVN7"},{"type":"listItem","spread":true,"position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Implement and simulate the discrete-time MPC controller","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"oDvhNrCHuj"}],"key":"RYGqNEM8g2"}],"key":"aGqjJRZQWP"},{"type":"listItem","spread":true,"position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Compare the continuous-time and discrete-time MPC results","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"OwWG4GaIt1"}],"key":"z6kOvoy0ac"}],"key":"cFZIewVKPP"}],"key":"Bml6q3ryGi"}],"key":"xIhBVbP9ZK"}],"key":"AA9RJWneoc"}],"identifier":"8c894093","label":"8c894093","html_id":"id-8c894093","key":"JeA1T6RsTE"},{"type":"block","kind":"notebook-code","data":{"executionInfo":{"elapsed":1,"status":"ok","timestamp":1761933612852,"user":{"displayName":"Sudheera Akalanka","userId":"10979872277429596063"},"user_tz":360},"id":"5a9988ed"},"children":[{"type":"code","lang":"python","executable":true,"value":"# Code to model vehicle steering dynamics\n\n# Function to compute the RHS of the system dynamics\ndef kincar_update(t, x, u, params):\n    # Get the parameters for the model\n    l = params['wheelbase']             # vehicle wheelbase\n    deltamax = params['maxsteer']         # max steering angle (rad)\n\n    # Saturate the steering input\n    delta = np.clip(u[1], -deltamax, deltamax)\n\n    # Return the derivative of the state\n    return np.array([\n        np.cos(x[2]) * u[0],            # xdot = cos(theta) v\n        np.sin(x[2]) * u[0],            # ydot = sin(theta) v\n        (u[0] / l) * np.tan(delta)      # thdot = v/l tan(delta)\n    ])\n\nkincar_params={'wheelbase': 3, 'maxsteer': 0.5}\n\n# Create nonlinear input/output system\nkincar = ctl.nlsys(\n    kincar_update, None, name=\"kincar\", params=kincar_params,\n    inputs=('v', 'delta'), outputs=('x', 'y', 'theta'),\n    states=('x', 'y', 'theta'))","identifier":"5a9988ed-code","enumerator":"15","html_id":"id-5a9988ed-code","key":"l0Q1ewGKHN"},{"type":"outputs","id":"503vdQwWpCUEmCpD-lpq1","children":[],"identifier":"5a9988ed-outputs","html_id":"id-5a9988ed-outputs","key":"j7NytsY88h"}],"identifier":"5a9988ed","label":"5a9988ed","html_id":"id-5a9988ed","key":"jlbvUcLXIe"}],"key":"ifDF24Gm86"},"references":{"cite":{"order":[],"data":{}}}}